<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>블로그</title>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github-dark.min.css">
<script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/common.min.js"></script>
<link href='https://fonts.googleapis.com/css?family=PT+Sans:400,700,400italic' rel='stylesheet' type='text/css'>

<style>
/* 주신 CSS 코드를 기반으로 재구성 및 조정 */
/*-----------------------------------------------------------------------------*/
/* BASIC LAYOUT */
/*-----------------------------------------------------------------------------*/
body {
    width: 960px;
    margin: 0 auto;
    font-family: 'pt sans', sans-serif;
    background-color: #f0f0f0; /* 밝은 배경 유지 */
}

main {
    max-width: 960px;
    margin: 28px auto;
    padding: 0 16px;
    min-height: calc(100vh - 56px);
}
main > header {
    display: flex;
    gap: 8px;
    align-items: center;
    margin-bottom: 12px;
    position: relative;
    z-index: 5; /* 헤더가 다른 요소 위에 오도록 조정 */
}

/*-----------------------------------------------------------------------------*/
/* LIBRARY LIST */
/*-----------------------------------------------------------------------------*/
ul.library {
    margin: 0;
    padding: 0 0 10px 0;
    list-style-type: none;
    overflow: hidden;
}

li.book {
    position: relative;
    top: 0;
    left: 0;
    margin: 0;
    padding: 10px;
    float: left;
    width: 140px;
    height: 224px;
    cursor: pointer;
    transition: background-color 0.2s;
    z-index: 1; /* 기본 책 z-index */
}

/* hover & active */
.book:hover { background-color: #E5E5E5; }
.book:active { background-color: #D9D9D9; }

/* 선택된 책은 z-index를 높여 가장 위에 오도록 하고, 커버 애니메이션 적용 */
li.book.selected {
    z-index: 4;
}

/*-----------------------------------------------------------------------------*/
/* BOOK COVERS */
/*-----------------------------------------------------------------------------*/
.book .cover {
    width: 140px;
    height: 224px;
    box-shadow: 3px 3px 5px rgba(0,0,0,.3);
}

.book .cover img {
    background-color: #e5e5e5;
    width: 140px;
    height: 224px;
    border: 0px solid #FFFFFF;
    transition: transform 0.3s ease-out, border-width 0.3s ease-out; /* 애니메이션 부드럽게 */
}

/* 선택된 책 표지 확대 및 테두리 */
.book.selected .cover img {
    transform: scale(1.4); /* 이미지 자체를 확대 */
    border-width: 5px; /* 테두리 추가 */
    border-color: #AAAAAA; /* 테두리 색상 */
}


/*-----------------------------------------------------------------------------*/
/* SUMMARY ABSTRACTS */
/*-----------------------------------------------------------------------------*/
#summaryPanel {
    position: absolute; /* 절대 위치 */
    display: flex;
    gap: 18px;
    opacity: 0;
    pointer-events: none; /* 클릭 비활성화 */
    width: 600px; /* 고정 너비 조정 */
    max-width: 90vw; /* 모바일 대응 */
    background: #E5E5E5;
    border: 1px solid #D9D9D9;
    border-radius: 10px;
    box-shadow: 0 10px 30px rgba(0,0,0,.4); /* 그림자 조정 */
    transition: opacity .28s ease, transform .28s ease;
    z-index: 10; /* 가장 위에 오도록 조정 */
    transform: translate(-50%, -10px); /* 초기 위치 조정 (숨겨진 상태) */
}
#summaryPanel.active {
    opacity: 1;
    pointer-events: auto; /* 클릭 활성화 */
    transform: translate(-50%, 0); /* 나타날 때의 위치 */
}

#summaryPanel .panel-cover{
  width: 160px; /* 패널 내 이미지 크기 조정 */
  height: 256px; /* 패널 내 이미지 크기 조정 */
  border-radius: 6px;
  overflow: hidden;
  flex-shrink: 0;
  box-shadow: 2px 2px 4px rgba(0,0,0,.2);
}
#summaryPanel .panel-cover img{
  width: 100%;
  height: 100%;
  object-fit: cover;
}
#summaryPanel .panel-content{
  padding: 14px 14px 14px 0;
  min-width: 0;
}
#summaryPanel h1, #summaryPanel h2, #summaryPanel p {
  cursor: text;
}
#summaryPanel h1 {
  font-size: 28px; /* 폰트 크기 조정 */
  line-height: 34px;
  margin: 0 0 4px 0;
  padding: 0;
}
#summaryPanel h2 {
  font-weight: normal;
  font-style: italic;
  font-size: 20px; /* 폰트 크기 조정 */
  margin: 0 0 10px 0;
  padding: 0 0 10px 0;
  border-bottom: 1px dotted #BBBBBB; /* 테두리 조정 */
}
#summaryPanel p {
  font-size: 16px; /* 폰트 크기 조정 */
  line-height: 22px;
  margin: 0;
  padding: 0;
}
#summaryPanel .panel-content ul.mini {
    margin: 10px 0;
    padding-left: 20px;
    list-style-type: disc;
}
#summaryPanel .panel-content ul.mini li {
    font-size: 15px;
    margin-bottom: 4px;
}
#summaryPanel .panel-content ul.mini a {
    color: #333;
    text-decoration: none;
}
#summaryPanel .panel-content ul.mini a:hover {
    text-decoration: underline;
}

/* PAGE OVERLAYS - 제거 (display: none 처리) */
.overlay-page {
    display: none !important;
}


/* 기존 CSS에서 필요한 부분 조정 */
.hidden { display: none !important }
.list { display: grid; gap: 12px; }
.item {
    display: block;
    padding: 14px;
    border: 1px solid #ccc;
    border-radius: 12px;
    background: #fff;
    color: #333;
    text-decoration: none;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}
.item .m { color: #999; font-size: 12px; margin-top: 4px; }
.post {
    padding: 16px;
    border: 1px solid #ccc;
    border-radius: 12px;
    background: #fff;
    color: #333;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}
.post .meta { color: #999; font-size: 12px; margin-bottom: 12px; }
.post img { max-width: 100%; border-radius: 10px; }
pre {
    background: #f4f4f4;
    border: 1px solid #ddd;
    padding: 12px;
    border-radius: 10px;
    overflow: auto;
}

/* 버튼 스타일 재정의 */
a.btn, button.btn {
  border: 1px solid #ccc;
  background: #f9f9f9;
  color: #333;
  padding: 8px 10px;
  border-radius: 10px;
  text-decoration: none;
  cursor: pointer;
  transition: background-color 0.2s ease, transform 0.2s ease;
}
a.btn:hover, button.btn:hover {
  background: #e9e9e9;
  transform: scale(1.05);
}
#backBtn::before { content: '← '; }

/* Debug drawer and pill */
.dbg-pill {
    display: none;
    align-items: center;
    gap: 6px;
    margin-left: auto;
    padding: 6px 10px;
    border-radius: 999px;
    border: 1px solid #ccc;
    background: rgba(255,255,255,0.7);
    backdrop-filter: blur(12px);
    color: #333;
}
.dbg-pill svg { width: 16px; height: 16px; stroke: #555; }
.dbg-pill.badge::after {
    content: "";
    width: 7px;
    height: 7px;
    border-radius: 50%;
    background: #ff6b6b;
    box-shadow: 0 0 0 4px rgba(255,107,107,.22);
    margin-left: 2px;
}
#dbgDrawer {
    position: fixed;
    right: 16px;
    top: 76px;
    display: none;
    min-width: 360px;
    width: min(720px, 92vw);
    max-height: 62vh;
    overflow: auto;
    border-radius: 12px;
    border: 1px solid #ccc;
    background: rgba(255,255,255,0.7);
    backdrop-filter: blur(14px);
}
#dbgDrawer.open { display: block; }
#dbgDrawer header {
    display: flex;
    gap: 8px;
    align-items: center;
    padding: 8px 10px;
    border-bottom: 1px solid #ddd;
}
#dbgDrawer header h4 { margin: 0; font-size: 12px; opacity: .85; color: #333; }
#dbgDrawer header .sp { flex: 1; }
#dbgDrawer header button {
    padding: 6px 8px;
    border: 1px solid #ddd;
    background: #f9f9f9;
    color: #333;
    border-radius: 8px;
}
#dbgDrawer pre { margin: 0; padding: 10px; color: #333; }

</style>
</head>
<body>
<main>
  <header>
    <button id="backBtn" class="btn" type="button">뒤로</button>
    <a id="homeBtn" class="btn" href="../" data-home="">홈</a>
    <h1 id="title" style="margin:0 0 0 8px;font-size:18px">분류 전체보기</h1>
    <button id="dbgPill" class="dbg-pill" title="Alt+D (디버그)">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="7" y="6" width="10" height="14" rx="5"/><path d="M5 10h14"/></svg>
      <span>Debug</span>
    </button>
  </header>

  <div class="content">
    <ul class="library"></ul>
  </div>

  <div id="summaryPanel">
    <div class="panel-cover"><img alt=""></div>
    <div class="panel-content"></div>
  </div>
  
  <div id="viewList" class="list hidden" aria-label="글 목록"></div>

  <section id="viewPost" class="post hidden" aria-label="글 본문">
    <h2 id="pTitle"></h2>
    <div id="pMeta" class="meta"></div>
    <article id="pBody"></article>
  </section>
</main>

<section id="dbgDrawer" role="dialog" aria-modal="true" aria-label="디버그">
  <header>
    <h4>디버그</h4><span class="sp"></span>
    <button id="wCopy">복사</button>
    <button id="wClear">지움</button>
    <button id="wHealth">헬스</button>
  </header>
  <pre id="wLog"></pre>
</section>

<script>
/* ===== Paths ===== */
const BASE = (function(){ const p=location.pathname; return /\/$/.test(p)?p:p.replace(/[^/]+$/,'/'); })();
const DATA_URL = BASE + 'data/posts.json';
const POSTS_DIR = BASE + 'posts/';

/* ===== Debug (pill+drawer, 에러때만 은은히 표시) ===== */
(function(){
  const pill = document.getElementById('dbgPill');
  const drawer = document.getElementById('dbgDrawer');
  const logEl = document.getElementById('wLog');
  const buf = [];
  const FORCE = /(?:\?|&)debug=1\b/.test(location.search) || localStorage.getItem('__blog_debug__')==='1';
  if (FORCE) pill.style.display='inline-flex';

  function line(t,m,x){ return `[${new Date().toLocaleTimeString()}] ${t.padEnd(5)} | ${m}${x?` | ${x}`:''}`; }
  function write(s){ buf.push(s); if(buf.length>300) buf.shift(); if(drawer.classList.contains('open')||FORCE){ logEl.textContent=buf.join('\n'); logEl.scrollTop=logEl.scrollHeight; } }
  function pulse(){ pill.classList.remove('badge'); void pill.offsetWidth; pill.classList.add('badge'); pill.style.display='inline-flex'; }

  window.dbg = (type,msg,extra) => {
    (type==='ERROR'?console.error:console.log)('[Blog]',type,msg,extra||'');
    write(line(type,msg,extra||''));
    if (type==='ERROR' || type==='WARN') pulse();
  };

  pill.addEventListener('click',()=>drawer.classList.toggle('open'));
  document.getElementById('wCopy').addEventListener('click',()=>navigator.clipboard.writeText(buf.join('\n')));
  document.getElementById('wClear').addEventListener('click',()=>{ buf.length=0; logEl.textContent=''; });
  document.getElementById('wHealth').addEventListener('click',()=>{ if (typeof runHealthCheck==='function') runHealthCheck(); });
  window.addEventListener('keydown',(e)=>{ if (e.altKey && (e.key==='d'||e.key==='D')) drawer.classList.toggle('open'); });
})();

/* ===== Utils ===== */
const $ = (s)=>document.querySelector(s);
const d = (x)=>x?new Date(x).toISOString().slice(0,10):'';
function esc(s){return String(s||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]))}
function placeholderCover(){
  const svg=`<svg xmlns='http://www.w3.org/2000/svg' width='280' height='448'><rect width='100%' height='100%' fill='%23202833'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-family='system-ui' font-size='13' fill='%238ea0b7'>no cover</text></svg>`;
  return 'data:image/svg+xml;utf8,'+encodeURIComponent(svg);
}
function coverCandidates(nameOrSlug, cover){
  const out=[]; const add=u=>{if(u && !out.includes(u)) out.push(u);};
  const noSlash=s=>(s||'').replace(/^\//,'');
  if (cover){ add(cover); add(BASE+noSlash(cover)); }
  const raw=String(nameOrSlug||'').trim();
  const dashed=raw.replace(/\s+/g,'-').replace(/[\/\\?#%:*|"<>]/g,'-');
  const unders=raw.replace(/\s+/g,'_').replace(/[\/\\?#%:*|"<>]/g,'_');
  const roots=[BASE+'assets/covers/','/assets/covers/'];
  const bases=[raw,dashed,unders,raw.toLowerCase()];
  const suf=['','','-cover','-커버',' 표지','-표지','_cover','_커버','_표지'];
  const exts=['jpg','png','webp','jpeg'];
  for(const r of roots) for(const b of bases) for(const s of suf) for(const e of exts) add(r+b+s+'.'+e);
  add(placeholderCover());
  return out;
}
async function ffetch(url,opt={},tag='fetch'){
  try{ const r=await fetch(url,opt); dbg('INFO',tag,r.status+' '+url); if(!r.ok) throw new Error(tag+' '+r.status); return r; }
  catch(e){ dbg('ERROR',tag+' 실패', (e&&e.message)||String(e)); throw e; }
}

/* ===== Data → Library ===== */
let ALL=[], CATS={}, library=[];
function Book(cover,title,author,abstract) {
    this.cover = cover;
    this.title = title;
    this.author = author;
    this.abstract = abstract;
    library.push(this);
}
function buildLibrary(){
  CATS={};
  ALL.forEach(p=>{ const c=p.category||'기타'; (CATS[c] ||= {name:c,posts:[]}).posts.push(p); });
  library.length=0;
  Object.keys(CATS).sort((a,b)=>a.localeCompare(b,'ko')).forEach(cat=>{
    const posts=CATS[cat].posts;
    const newest=posts.slice().sort((a,b)=>new Date(b.date)-new Date(a.date))[0];
    const cand=coverCandidates(cat, newest?.cover);
    const bk=new Book(cand[0]||placeholderCover(), cat, '', posts.length+'개의 글'); bk._cat=cat; bk._coverCands=cand;
  });
}

/* ===== Library render & panel ===== */
let openCat = null;
let openBookEl = null;

function renderCats(){
  $('#title').textContent='분류 전체보기';
  $('.content').classList.remove('hidden');
  $('#viewList').classList.add('hidden');
  $('#viewPost').classList.add('hidden');
  const ul=$('.library'); ul.innerHTML='';
  library.forEach(bk=>{
    ul.insertAdjacentHTML('beforeend',
      `<li class="book" data-cat="${esc(bk._cat)}">
         <div class="cover"><img src="${esc(placeholderCover())}" data-cands='${esc(JSON.stringify(bk._coverCands||[]))}' alt="${esc(bk.title)}"></div>
       </li>`
    );
  });
  initLazyCovers();
}

function panelFor(cat, bookEl) {
    const posts=(CATS[cat]?.posts||[]).slice().sort((a,b)=>new Date(b.date)-new Date(a.date)).slice(0,8);
    const bk=library.find(b=>b._cat===cat)||{};
    const cover=(bk._coverCands && bk._coverCands[0])||placeholderCover();
    
    $('#summaryPanel .panel-cover img').src = cover;
    let html = `<h1>${esc(cat)}</h1><h2>최근 글</h2>`; // 'by' 제거, '최근 글' 추가
    html += `<p style="font-size: 14px; color: #666;">총 ${posts.length}개의 글</p>`; // 총 글 개수 표시
    html += `<ul class="mini">`;
    posts.forEach(p => html += `<li><a href="#/post/${encodeURIComponent(p.slug)}">${esc(p.title)}</a> <small>· ${esc(d(p.date))}</small></li>`);
    html += `</ul><p style="margin-top:10px"><a href="#/category/${encodeURIComponent(cat)}">이 카테고리 전체 보기 →</a></p>`;
    $('#summaryPanel .panel-content').innerHTML = html;
}


function openPanel(cat, bookEl) {
    const summaryPanel = $('#summaryPanel');

    if (openBookEl === bookEl) {
        // 이미 열려있는 같은 책을 다시 클릭하면 닫기
        closePanel();
        return;
    }
    
    // 다른 책을 클릭하면 기존 패널 닫고 새로 열기
    closePanel();
    openCat = cat;
    openBookEl = bookEl;

    panelFor(cat, bookEl); // 데이터 로드 및 패널 내용 업데이트
    
    const bookRect = bookEl.getBoundingClientRect();
    const coverRect = bookEl.querySelector('.cover').getBoundingClientRect();

    // 요약 패널 위치 조정: 클릭한 책 표지 근처에 오도록 조정
    summaryPanel.style.left = (bookRect.left + window.scrollX + coverRect.width + 30) + 'px';
    summaryPanel.style.top = (bookRect.top + window.scrollY) + 'px';
    
    // 뷰포트 경계를 벗어나지 않도록 조정 (선택 사항)
    const panelWidth = summaryPanel.offsetWidth;
    const panelHeight = summaryPanel.offsetHeight;
    const viewportWidth = window.innerWidth;
    const viewportHeight = window.innerHeight;

    let targetLeft = bookRect.left + window.scrollX + coverRect.width + 30;
    let targetTop = bookRect.top + window.scrollY;

    if (targetLeft + panelWidth > viewportWidth + window.scrollX - 20) {
        targetLeft = bookRect.left + window.scrollX - panelWidth - 30;
    }
    if (targetTop + panelHeight > viewportHeight + window.scrollY - 20) {
        targetTop = viewportHeight + window.scrollY - panelHeight - 20;
    }
    if (targetTop < window.scrollY + 20) {
        targetTop = window.scrollY + 20;
    }

    summaryPanel.style.left = targetLeft + 'px';
    summaryPanel.style.top = targetTop + 'px';

    summaryPanel.classList.add('active'); // 패널 활성화
    
    bookEl.classList.add('selected'); // 선택된 책 스타일 적용
    bookEl.style.zIndex = 4; // 선택된 책을 맨 위로
}

function closePanel() {
    if (!openBookEl) return;
    
    const summaryPanel = $('#summaryPanel');
    
    summaryPanel.classList.remove('active'); // 패널 비활성화

    // 선택된 책 스타일 원래대로 되돌리기
    openBookEl.classList.remove('selected');
    openBookEl.style.zIndex = 'auto';
    openBookEl.querySelector('img').style.transform = 'scale(1)';

    openBookEl = null;
    openCat = null;
}

/* 클릭 이벤트 핸들러: 이제 책을 클릭할 때만 작동 */
document.addEventListener('click', (e) => {
    const li = e.target.closest('li.book');
    const isClickInsidePanel = e.target.closest('#summaryPanel');

    if (li) {
        // 책 표지 클릭 시
        const cat = li.dataset.cat;
        openPanel(cat, li);
    } else if (isClickInsidePanel) {
        // 패널 내부를 클릭하면 아무것도 하지 않음 (기능 유지)
        return;
    } else {
        // 그 외 모든 클릭 (빈 공간 포함)에는 아무것도 하지 않음
        return;
    }
});

document.addEventListener('keydown',(e)=>{ if(e.key==='Escape') closePanel(); });

/* ===== 카테고리 → 글 목록 ===== */
function renderList(cat){
  closePanel();
  $('#title').textContent=cat;
  $('.content').classList.add('hidden');
  $('#viewList').classList.remove('hidden');
  $('#viewPost').classList.add('hidden');
  const list=ALL.filter(p=>(p.category||'기타')===cat).sort((a,b)=>new Date(b.date)-new Date(a.date));
  $('#viewList').innerHTML=list.length
    ? list.map(p=>`<a class="item" href="#/post/${encodeURIComponent(p.slug)}"><div class="t">${esc(p.title)}</div><div class="m">${esc(d(p.date))} · ${esc(p.summary||'')}</div></a>`).join('')
    : '<p class="m">글이 없습니다.</p>';
}

/* ===== 게시글 ===== */
async function renderPost(slug){
  closePanel();
  $('.content').classList.add('hidden');
  $('#viewList').classList.add('hidden');
  $('#viewPost').classList.remove('hidden');
  const m=ALL.find(p=>p.slug===slug)||{title:slug};
  $('#title').textContent=m.category||'게시글';
  $('#pTitle').textContent=m.title;
  $('#pMeta').textContent=[m.category,d(m.date)].filter(Boolean).join(' · ');
  $('#pBody').innerHTML='<p class="m">불러오는 중…</p>';
  try{
    const url=POSTS_DIR+encodeURIComponent(slug)+'.md';
    const r=await ffetch(url,{cache:'no-cache'},'post-md:'+slug);
    const md=await r.text();
    const body=md.replace(/^---[\s\S]*?---\s*/,'');
    $('#pBody').innerHTML=marked.parse(body,{mangle:false,headerIds:true});
    $('#pBody').querySelectorAll('pre code').forEach(b=>hljs.highlightElement(b));
    document.title=m.title+' - 블로그';
  }catch(e){
    $('#pBody').innerHTML='<p class="m">게시글을 찾을 수 없습니다.</p>';
  }
}

/* ===== 라우터 ===== */
function route(){
  const mPost=location.hash.match(/^#\/post\/(.+)$/);
  const mCat =location.hash.match(/^#\/category\/(.+)$/);
  if(mPost) return renderPost(decodeURIComponent(mPost[1]));
  if(mCat)  return renderList(decodeURIComponent(mCat[1]));
  return renderCats();
}
addEventListener('hashchange', route);

/* ===== Lazy cover ===== */
function initLazyCovers(){
  const getCands=(img)=>{ try{ return [...new Set(JSON.parse(img.getAttribute('data-cands')||'[]'))]; }catch{ return []; } };
  const io=new IntersectionObserver((ents)=>{
    ents.forEach(e=>{
      if(!e.isIntersecting) return;
      const img=e.target; if(img.dataset._started) return; img.dataset._started='1';
      const cands=getCands(img); let i=-1;
      const next=()=>{ i++; if(i<cands.length){ img.src=cands[i]; return; } img.onerror=img.onload=null; img.src=placeholderCover(); dbg('WARN','img fallback'); };
      img.onload =()=>{ dbg('INFO','img ok',img.currentSrc||img.src); img.onerror=img.onload=null; };
      img.onerror=()=>{ dbg('WARN','img fail',img.src); setTimeout(next,40); };
      next(); io.unobserve(img);
    });
  },{rootMargin:'200px'});
  document.querySelectorAll('.library img[data-cands]').forEach(img=>io.observe(img));
}

/* ===== 헬스체크 ===== */
async function runHealthCheck(){
  dbg('INFO','health start');
  try{
    const r=await ffetch(DATA_URL,{cache:'no-store'},'posts.json');
    const j=await r.json(); dbg('INFO','posts='+((j.posts||[]).length));
    if ((j.posts||[]).length){
      const first=j.posts[0];
      try{ await ffetch(POSTS_DIR+encodeURIComponent(first.slug)+'.md',{cache:'no-store'},'first-md'); }catch{}
      const cat=first.category||'기타'; const cand=coverCandidates(cat,first.cover||'')[0]; try{ await ffetch(cand,{cache:'no-store'},'cover'); }catch{}
    }
  }catch{}
  dbg('INFO','health end');
}

/* ===== 홈/뒤로 핸들러(기능 유지) ===== */
document.getElementById('backBtn').addEventListener('click',()=>{ if(history.length>1) history.back(); else location.href='../'; });
(() => { const el=document.getElementById('homeBtn'); const explicit=(el.dataset.home||'').trim(); const fallback=new URL('../',location.href).href; el.href= explicit || fallback; })();

/* ===== 부팅 ===== */
(async function init(){
  try{
    const r=await ffetch(DATA_URL,{cache:'no-cache'},'posts.json');
    const j=await r.json();
    ALL=(j.posts||[]).map(p=>({...p,category:p.category||'기타'}));
  }catch(e){ dbg('ERROR','posts.json 불러오기 실패'); ALL=[]; }
  buildLibrary();
  route();
})();
</script>
</body>
</html>
