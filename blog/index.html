<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Blog</title>

<!-- libs -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github.min.css">
<script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/common.min.js"></script>

<style>
  :root{--line:#1e2732;--panel:#10171e;--text:#e7edf3;--muted:#a8b3bf}
  *{box-sizing:border-box}
  body{margin:0;background:#0d141b;color:var(--text);font:15px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Arial}
  main{max-width:1040px;margin:28px auto;padding:0 16px}
  header{display:flex;gap:8px;align-items:center;margin-bottom:12px}
  a.btn,button.btn{border:1px solid var(--line);background:#0b1117;color:var(--text);padding:8px 10px;border-radius:10px;text-decoration:none}

  /* Î™©Î°ù/Î≥∏Î¨∏ */
  .list{display:grid;gap:12px}
  .item{display:block;padding:14px;border:1px solid var(--line);border-radius:12px;background:var(--panel);color:var(--text);text-decoration:none}
  .item .m{color:var(--muted);font-size:12px;margin-top:4px}
  .post{padding:16px;border:1px solid var(--line);border-radius:12px;background:var(--panel)}
  .post .meta{color:var(--muted);font-size:12px;margin-bottom:12px}
  .post img{max-width:100%;border-radius:10px}
  pre{background:#0b1117;border:1px solid var(--line);padding:12px;border-radius:10px;overflow:auto}
  .hidden{display:none}

  /* ====== Jabas Library ====== */
  .libwrap{position:relative}
  .libwrap ul.library{margin:0;padding:0 0 10px 0;list-style:none;overflow:hidden}
  .libwrap li.book{position:relative;top:0;left:0;margin:0;padding:10px;float:left;width:140px;height:224px;cursor:pointer}
  .libwrap li.book.selected{z-index:4}
  .libwrap .book:hover{background-color:#E5E5E5}
  .libwrap .book:active{background-color:#D9D9D9}
  .libwrap .book.selected:hover,.libwrap li.book.selected:active{background-color:transparent}

  .libwrap .book .cover{cursor:pointer;width:140px;height:224px;box-shadow:3px 3px 5px rgba(0,0,0,.3)}
  .libwrap .book .cover img{background:#e5e5e5;width:140px;height:224px;border:0 solid #fff}

  .libwrap .book.selected .cover{position:absolute;top:10px}
  .libwrap .book.selected.left-side.first .cover, .libwrap .book.selected.right-side .cover{left:10px;right:auto}
  .libwrap .book.selected.right-side.last .cover, .libwrap .book.selected.left-side .cover{left:auto;right:10px}

  .libwrap li.book .summary{
    display:none;cursor:default;position:absolute;top:10px;z-index:4;padding:10px;width:450px;height:0;overflow:hidden;
    background:#E5E5E5;color:#0d1117;border-radius:8px
  }
  .libwrap .summary h1{font-size:26px;line-height:32px;margin:0 0 4px}
  .libwrap .summary h2{font-weight:400;font-style:italic;font-size:20px;margin:0 0 12px;padding:0 0 12px;border-bottom:2px dotted #999}
  .libwrap .summary p{font-size:16px;line-height:22px;margin:0}
  .libwrap .summary .mini{list-style:none;margin:10px 0 0;padding:0}
  .libwrap .summary .mini li{margin:0 0 6px}
  .libwrap .summary .mini a{color:#0b6cff;text-decoration:underline}

  .libwrap .left-side .summary{left:160px;border-right:10px solid #D9D9D9}
  .libwrap .left-side.first .summary{left:320px}
  .libwrap .right-side .summary{left:-480px;border-left:10px solid #D9D9D9}
  .libwrap .right-side.last .summary{left:-640px}

  .libwrap .overlay-page{display:none;position:absolute;top:0;left:0;right:0;bottom:0;background:#fff;opacity:.7;z-index:2}
  .libwrap .overlay-summary{display:none;position:absolute;top:0;left:0;height:0;width:480px;background:#E5E5E5;opacity:.9;z-index:3}

  .clearfix::after{content:"";display:block;clear:both}

  /* ‚òëÔ∏è Í≤πÏπ® Î∞©ÏßÄ: Jabas ÏòÅÏó≠Îßå content-box */
  .libwrap li.book,
  .libwrap .book .cover,
  .libwrap .book .cover img{ box-sizing:content-box }

  /* ===== ÏßÑÎã® Ïπ¥Îìú ===== */
  .empty {margin:24px 0;padding:16px;border:1px solid var(--line);background:#0f151c;border-radius:12px}
  .empty h3{margin:0 0 8px;font-size:16px}
  .empty code{background:#0b1117;border:1px solid var(--line);padding:2px 6px;border-radius:6px}
  .empty ul{margin:10px 0 0 18px}

  /* ===== ÎîîÎ≤ÑÍ∑∏ Ìå®ÎÑê ===== */
  #dbgToggle{
    position:fixed;right:12px;bottom:12px;z-index:99;
    width:34px;height:34px;border-radius:10px;border:1px solid var(--line);
    background:#0b1117;color:#fff;display:grid;place-items:center;cursor:pointer;opacity:.8
  }
  #dbgToggle:hover{opacity:1}
  #dbgPanel{
    position:fixed;right:12px;bottom:56px;width:min(520px,92vw);max-height:60vh;overflow:auto;
    background:#0b1117;border:1px solid var(--line);border-radius:12px;padding:10px;z-index:99;display:none
  }
  #dbgPanel.open{display:block}
  #dbgPanel h4{margin:0 0 8px;font-size:14px}
  #dbgPanel pre{margin:0;font:12px/1.45 ui-monospace,SFMono-Regular,Consolas,monospace;background:#0c1218;border:1px solid #12202c}
  #dbgPanel .row{display:flex;gap:6px;align-items:center;margin-bottom:8px}
  #dbgPanel .row button{padding:6px 8px;border-radius:8px;border:1px solid #273445;background:#0e1821;color:#dfe7ef;cursor:pointer}
  #dbgPanel .row code{background:#0c1218;border:1px solid #12202c;padding:2px 6px;border-radius:6px}
  #dbgBadge{
    position:fixed;left:12px;bottom:12px;z-index:99;
    display:none;background:#2b1120;border:1px solid #61203e;border-radius:10px;color:#ffd3df;
    padding:6px 10px;font-size:12px
  }
  #dbgBadge.show{display:block}
</style>
</head>
<body>
<main>
  <header>
    <a class="btn" id="homeBtn" href="../" data-home="">‚Üê Ìôà</a>
    <button id="backBtn" class="btn" type="button" aria-label="Îí§Î°ú Í∞ÄÍ∏∞">Îí§Î°ú</button>
    <h1 id="title" style="margin:0 0 0 8px;font-size:18px">Î∂ÑÎ•ò Ï†ÑÏ≤¥Î≥¥Í∏∞</h1>
  </header>

  <!-- Ïπ¥ÌÖåÍ≥†Î¶¨ = Ï±ÖÏû• -->
  <section id="viewCats" class="libwrap">
    <ul class="library clearfix"></ul>
    <div class="overlay-page"></div>
    <div class="overlay-summary"></div>
    <div id="diag" class="empty hidden"></div>
  </section>

  <!-- Í∏Ä Î™©Î°ù -->
  <div id="viewList" class="list hidden" aria-label="Í∏Ä Î™©Î°ù"></div>

  <!-- Î≥∏Î¨∏ -->
  <section id="viewPost" class="post hidden" aria-label="Í∏Ä Î≥∏Î¨∏">
    <h2 id="pTitle"></h2>
    <div id="pMeta" class="meta"></div>
    <article id="pBody"></article>
  </section>
</main>

<!-- ÎîîÎ≤ÑÍ∑∏ UI -->
<button id="dbgToggle" title="Alt+D Î°ú ÌÜ†Í∏Ä">üêû</button>
<div id="dbgPanel">
  <div class="row">
    <h4 style="flex:1">ÎîîÎ≤ÑÍ∑∏ Ìå®ÎÑê</h4>
    <button id="dbgHealth">Ìó¨Ïä§Ï≤¥ÌÅ¨</button>
    <button id="dbgCopy">Î°úÍ∑∏ Î≥µÏÇ¨</button>
    <button id="dbgClear">ÏßÄÏö∞Í∏∞</button>
  </div>
  <div class="row" style="flex-wrap:wrap">
    <div>BASE: <code id="dbgBase"></code></div>
    <div>DATA_URL: <code id="dbgData"></code></div>
  </div>
  <pre id="dbgLog"></pre>
</div>
<div id="dbgBadge"></div>

<script>
/* ===== Í≤ΩÎ°ú/Í∏∞Î≥∏ ===== */
const BASE = (function(){ const p=location.pathname; return /\/$/.test(p)?p:p.replace(/[^/]+$/,'/'); })();
const DATA_URL  = BASE + 'data/posts.json';
const POSTS_DIR = BASE + 'posts/';

/* Ìôà Î≤ÑÌäº: data-home Ïö∞ÏÑ†, ÏóÜÏúºÎ©¥ ../ */
(() => {
  const el = document.getElementById('homeBtn'); if (!el) return;
  const explicit = (el.dataset.home || '').trim();
  const fallback = new URL('../', location.href).href;
  el.href = explicit || fallback;
})();
document.getElementById('backBtn')?.addEventListener('click', () => {
  if (history.length > 1) history.back(); else document.getElementById('homeBtn').click();
});

/* ====== ÎîîÎ≤ÑÍ∑∏ ÎèÑÍµ¨ ====== */
const DEBUG = /(?:\?|&)debug=1\b/.test(location.search) || localStorage.getItem('__blog_debug__')==='1';
const dbgLogEl = ()=>document.getElementById('dbgLog');
const dbgBadge = document.getElementById('dbgBadge');

function dbgLine(type, msg, extra){
  const t = new Date().toLocaleTimeString();
  return `[${t}] ${type.padEnd(7)} ‚îÇ ${msg}${extra?` ‚îÇ ${extra}`:''}`;
}
function dbg(type, msg, extra){
  try{
    const el = dbgLogEl(); if (!el) return;
    el.textContent += (el.textContent?'\n':'') + dbgLine(type, msg, extra);
    el.scrollTop = el.scrollHeight;
  }catch{}
  // ÎßàÏßÄÎßâ ÏóêÎü¨Î•º ÏûëÏùÄ Î±ÉÏßÄÎ°ú
  if (type==='ERROR'){
    dbgBadge.textContent = msg;
    dbgBadge.classList.add('show');
    setTimeout(()=>dbgBadge.classList.remove('show'), 3500);
  }
  // ÏΩòÏÜîÎèÑ ÎÇ®ÍπÄ
  (type==='ERROR'?console.error:console.log)('[Blog]', type, msg, extra||'');
}
function dbgOpen(open=true){
  const p = document.getElementById('dbgPanel');
  p.classList.toggle('open', open);
  if (open){ localStorage.setItem('__blog_debug__','1'); }
  else { localStorage.removeItem('__blog_debug__'); }
}
(function setupDbg(){
  document.getElementById('dbgBase').textContent = BASE;
  document.getElementById('dbgData').textContent = DATA_URL;
  document.getElementById('dbgToggle').addEventListener('click', ()=>dbgOpen(!document.getElementById('dbgPanel').classList.contains('open')));
  document.getElementById('dbgHealth').addEventListener('click', runHealthCheck);
  document.getElementById('dbgCopy').addEventListener('click', ()=>{
    navigator.clipboard.writeText(dbgLogEl().textContent||'').then(()=>dbg('INFO','Î°úÍ∑∏ Î≥µÏÇ¨ ÏôÑÎ£å'));
  });
  document.getElementById('dbgClear').addEventListener('click', ()=>{ dbgLogEl().textContent=''; });
  window.addEventListener('keydown', (e)=>{ if (e.altKey && (e.key==='d' || e.key==='D')) dbgOpen(!document.getElementById('dbgPanel').classList.contains('open')); });
  if (DEBUG) dbgOpen(true);
  // Ï†ÑÏó≠ Ïò§Î•ò Ïû°Í∏∞
  window.addEventListener('error', (e)=>dbg('ERROR', e.message, e.filename+':'+e.lineno));
  window.addEventListener('unhandledrejection', (e)=>dbg('ERROR','UnhandledRejection', String(e.reason||e)));
})();
/* fetch ÎûòÌçº */
async function ffetch(url, opt={}, tag='fetch'){
  dbg('INFO', `HTTP ${tag} ÏãúÏûë`, url);
  try{
    const r = await fetch(url, opt);
    dbg('INFO', `HTTP ${tag} ÏÉÅÌÉú ${r.status}`, url);
    if (!r.ok) throw new Error(`${tag} HTTP ${r.status}`);
    return r;
  }catch(err){
    dbg('ERROR', `${tag} Ïã§Ìå®`, (err&&err.message)||String(err));
    throw err;
  }
}

/* ===== Ïú†Ìã∏ ===== */
const $  = (s)=>document.querySelector(s);
const d  = (x)=>x?new Date(x).toISOString().slice(0,10):'';
const esc= (s)=>String(s||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
let LAST_ERR = '';

function placeholderCover(){
  const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='280' height='448'>
    <rect width='100%' height='100%' fill='%23e8e8e8'/>
    <text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-family='system-ui' font-size='12' fill='%23666'>no cover</text>
  </svg>`;
  return 'data:image/svg+xml;utf8,'+encodeURIComponent(svg);
}

/* Ïª§Î≤Ñ ÏûêÎèôÌÉêÏÉâ */
function coverCandidates(nameOrSlug, cover){
  const out = []; const add = (u)=>{ if(u && !out.includes(u)) out.push(u); }; const noSlash=(s)=>(s||'').replace(/^\//,'');
  if (cover){ add(cover); add(BASE + noSlash(cover)); }

  const raw=String(nameOrSlug||'').trim();
  const rawEnc=encodeURIComponent(raw);
  const dashed=raw.replace(/\s+/g,'-').replace(/[\/\\?#%:*|"<>]/g,'-');
  const undersc=raw.replace(/\s+/g,'_').replace(/[\/\\?#%:*|"<>]/g,'_');
  const nospace=raw.replace(/\s+/g,'');
  const lower=raw.toLowerCase();
  const suffixes=['',' cover',' Ïª§Î≤Ñ','-cover','-Ïª§Î≤Ñ','_cover','_Ïª§Î≤Ñ',' ÌëúÏßÄ','-ÌëúÏßÄ','_ÌëúÏßÄ'];
  const bases=[raw,rawEnc,dashed,undersc,nospace,lower];
  const roots=[BASE+'assets/covers/','/assets/covers/'];
  const exts=['jpg','png','webp'];
  for(const root of roots){ for(const base of bases){ for(const suf of suffixes){ for(const ext of exts){ add(root+base+suf+'.'+ext); }}}}
  add(placeholderCover()); return out;
}

/* ===== Îç∞Ïù¥ÌÑ∞ ===== */
let ALL=[], CATS={}, library=[];
function Book(cover,title,author,abstract){ this.cover=cover; this.title=title; this.author=author; this.abstract=abstract; library.push(this); }
function buildLibraryFromPosts(){
  CATS = {};
  ALL.forEach(p => { const c=p.category||'Í∏∞ÌÉÄ'; (CATS[c] ||= {name:c,posts:[]}).posts.push(p); });
  library.length = 0;
  Object.keys(CATS).sort((a,b)=>a.localeCompare(b,'ko')).forEach(cat=>{
    const posts=CATS[cat].posts;
    const newest=posts.slice().sort((a,b)=>new Date(b.date)-new Date(a.date))[0];
    const cand=coverCandidates(cat, newest?.cover);
    const bk=new Book(cand[0]||placeholderCover(), cat, '', posts.length+'Í∞úÏùò Í∏Ä');
    bk._cat=cat; bk._coverCands=cand;
  });
}

/* ===== ÏßÑÎã® Ïπ¥Îìú ===== */
function showDiag(title, lines=[]){
  const box = document.getElementById('diag');
  box.classList.remove('hidden');
  box.innerHTML = `<h3>${esc(title)}</h3>
  <div style="font-size:13px;opacity:.9">BASE: <code>${esc(BASE)}</code><br>DATA_URL: <code>${esc(DATA_URL)}</code><br>Ï£ºÏÜå: <code>${esc(location.pathname)}</code></div>
  ${lines.length? `<ul>${lines.map(s=>`<li>${esc(s)}`).join('')}</ul>`:''}
  ${LAST_ERR? `<div style="margin-top:8px;color:#ffb3b3">Ïò§Î•ò: ${esc(LAST_ERR)}</div>`:''}`;
}

/* Î£®Ìä∏: Ï±ÖÏû• Î†åÎçî */
function renderCats(){
  $('#title').textContent='Î∂ÑÎ•ò Ï†ÑÏ≤¥Î≥¥Í∏∞';
  $('#viewCats').classList.remove('hidden');
  $('#viewList').classList.add('hidden');
  $('#viewPost').classList.add('hidden');

  const $lib = document.querySelector('#viewCats ul.library');
  $lib.innerHTML='';

  const classlist = ['left-side first','left-side','left-side','right-side','right-side','right-side last'];
  library.forEach(bk=>{
    let html = `<li class="book ${classlist[0]}" data-cat="${esc(bk._cat)}">`;
    html += `<div class="cover"><img src="${esc(placeholderCover())}" data-cands='${esc(JSON.stringify(bk._coverCands||[]))}' alt="${esc(bk.title)}"/></div>`;
    html += `<div class="summary"></div></li>`;
    $lib.insertAdjacentHTML('beforeend', html);
    const cn=classlist.shift(); classlist.push(cn);
  });

  // summary(ÏµúÍ∑ºÍ∏Ä)
  document.querySelectorAll('#viewCats li.book').forEach(li=>{
    const cat = li.dataset.cat;
    const list = (CATS[cat]?.posts||[]).slice().sort((a,b)=>new Date(b.date)-new Date(a.date)).slice(0,8);
    const s = li.querySelector('.summary');
    let html = `<h1>${esc(cat)}</h1><h2>ÏµúÍ∑º Í∏Ä</h2><ul class="mini">`;
    list.forEach(p=> html += `<li><a href="#/post/${encodeURIComponent(p.slug)}">${esc(p.title)}</a> <small>¬∑ ${esc(d(p.date))}</small></li>`);
    html += `</ul><p style="margin-top:8px"><a href="#/category/${encodeURIComponent(cat)}">Ïù¥ Ïπ¥ÌÖåÍ≥†Î¶¨ Ï†ÑÏ≤¥ Î≥¥Í∏∞ ‚Üí</a></p>`;
    s.innerHTML = html;
  });

  // Îç∞Ïù¥ÌÑ∞Í∞Ä 0Ïù¥Î©¥ ÏßÑÎã® ÌëúÏãú
  if (library.length === 0){
    const tips = [];
    if (location.protocol === 'file:') tips.push('Î°úÏª¨ ÌååÏùº(file://)ÏóêÏÑúÎäî fetchÍ∞Ä ÎßâÌòÄÏöî. ÏûÑÏãú ÏÑúÎ≤ÑÎ°ú Ïó¥Ïñ¥Ï£ºÏÑ∏Ïöî: python -m http.server');
    tips.push('posts.jsonÏù¥ ÏóÜÍ±∞ÎÇò ÎπÑÏñ¥ÏûàÏùÑ Ïàò ÏûàÏñ¥Ïöî ‚Üí '+DATA_URL+' Í≤ΩÎ°ú ÌôïÏù∏');
    tips.push('Ìè¥Îçî Íµ¨Ï°∞: /blog/index.html, /blog/data/posts.json, /blog/posts/*.md');
    showDiag('Î∂àÎü¨Ïò¨ Ïπ¥ÌÖåÍ≥†Î¶¨Í∞Ä ÏóÜÏäµÎãàÎã§.', tips);
  }
}

/* Ïπ¥ÌÖåÍ≥†Î¶¨ Î™©Î°ù */
function renderList(cat){
  $('#title').textContent=cat;
  $('#viewCats').classList.add('hidden');
  $('#viewList').classList.remove('hidden');
  $('#viewPost').classList.add('hidden');

  const list = ALL.filter(p => (p.category||'Í∏∞ÌÉÄ')===cat).sort((a,b)=>new Date(b.date)-new Date(a.date));
  $('#viewList').innerHTML = list.length
    ? list.map(p=>`<a class="item" href="#/post/${encodeURIComponent(p.slug)}"><div class="t">${esc(p.title)}</div><div class="m">${d(p.date)} ¬∑ ${esc(p.summary||'')}</div></a>`).join('')
    : '<p class="m">Í∏ÄÏù¥ ÏóÜÏäµÎãàÎã§.</p>';
}

/* Î≥∏Î¨∏ */
async function renderPost(slug){
  $('#viewCats').classList.add('hidden');
  $('#viewList').classList.add('hidden');
  $('#viewPost').classList.remove('hidden');

  const m = ALL.find(p=>p.slug===slug) || {title:slug};
  $('#title').textContent = m.category || '';
  $('#pTitle').textContent = m.title;
  $('#pMeta').textContent = [m.category,d(m.date)].filter(Boolean).join(' ¬∑ ');
  $('#pBody').innerHTML = '<p class="m">Î∂àÎü¨Ïò§Îäî Ï§ë‚Ä¶</p>';

  try{
    const url = POSTS_DIR + encodeURIComponent(slug) + '.md';
    const r = await ffetch(url,{cache:'no-cache'}, 'post-md:'+slug);
    const md = await r.text();
    const body = md.replace(/^---[\s\S]*?---\s*/, '');
    $('#pBody').innerHTML = marked.parse(body,{mangle:false,headerIds:true});
    $('#pBody').querySelectorAll('pre code').forEach(b=>hljs.highlightElement(b));
    document.title = m.title + ' - Blog';
  }catch(e){
    LAST_ERR = (e && e.message) ? e.message : String(e||'');
    $('#pBody').innerHTML = '<p class="m">Í≤åÏãúÍ∏ÄÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.</p>';
  }
}

/* ÎùºÏö∞ÌåÖ */
function route(){
  try{
    const mPost=location.hash.match(/^#\/post\/(.+)$/);
    const mCat =location.hash.match(/^#\/category\/(.+)$/);
    if(mPost) return renderPost(decodeURIComponent(mPost[1]));
    if(mCat)  return renderList(decodeURIComponent(mCat[1]));
    return renderCats();
  }catch(err){
    dbg('ERROR','route Ïã§Ìå®', String(err));
  }
}
window.addEventListener('hashchange', route);

/* Lazy + Ìè¥Î∞± (Î¨¥ÌïúÎ£®ÌîÑ/ÍπúÎπ°ÏûÑ Î∞©ÏßÄ + Î°úÍπÖ) */
function initLazyCovers(){
  const getCands = (img) => {
    try{
      const arr = JSON.parse(img.getAttribute('data-cands') || '[]');
      return [...new Set(arr)];
    }catch{ return []; }
  };

  const io = new IntersectionObserver((entries)=>{
    entries.forEach(e=>{
      if (!e.isIntersecting) return;
      const img = e.target;
      if (img.dataset._started) return;
      img.dataset._started = '1';

      const cands = getCands(img);
      let i = -1;

      const advance = () => {
        i += 1;
        if (i < cands.length){
          const u = cands[i];
          dbg('INFO','img try', u);
          img.src = u;
          return;
        }
        img.onerror = null;
        img.onload  = null;
        img.src = placeholderCover();
        dbg('ERROR','img Î™®Îì† ÌõÑÎ≥¥ Ïã§Ìå®, placeholder Ï†ÅÏö©');
      };

      img.onload = () => { dbg('INFO','img ok', img.currentSrc||img.src); img.onerror = null; img.onload = null; };
      img.onerror = () => { dbg('ERROR','img fail', img.src); setTimeout(advance, 50); };

      advance();         // ÏãúÏûë
      io.unobserve(img);
    });
  }, { rootMargin: '200px' });

  document.querySelectorAll('#viewCats .library img[data-cands]').forEach(img => io.observe(img));
}

/* Ìó¨Ïä§Ï≤¥ÌÅ¨ */
async function runHealthCheck(){
  dbg('INFO','‚Äî Ìó¨Ïä§Ï≤¥ÌÅ¨ ÏãúÏûë ‚Äî');
  try{
    const r = await ffetch(DATA_URL,{cache:'no-store'},'posts.json');
    const j = await r.json();
    dbg('INFO',`posts.json ok, posts=${(j.posts||[]).length}`);
    if ((j.posts||[]).length){
      const first = j.posts[0];
      const mdURL = POSTS_DIR + encodeURIComponent(first.slug) + '.md';
      try{
        await ffetch(mdURL,{cache:'no-store'},'first-md');
        dbg('INFO','first md ok', mdURL);
      }catch{}
      // Ïª§Î≤Ñ ÌõÑÎ≥¥ ÌïòÎÇò ÌÖåÏä§Ìä∏
      const cat = first.category || 'Í∏∞ÌÉÄ';
      const cand = coverCandidates(cat, first.cover||'')[0];
      try{
        await ffetch(cand,{cache:'no-store'},'cover-test');
        dbg('INFO','cover candidate ok', cand);
      }catch{}
    }
  }catch{}
  dbg('INFO','‚Äî Ìó¨Ïä§Ï≤¥ÌÅ¨ ÏôÑÎ£å ‚Äî');
}

/* Î∂ÄÌåÖ */
(async function init(){
  if (location.protocol === 'file:'){
    showDiag('Î°úÏª¨ ÌååÏùº Î™®Îìú(file://)ÏóêÏÑúÎäî Îç∞Ïù¥ÌÑ∞ Î°úÎìúÍ∞Ä Ï∞®Îã®ÎèºÏöî.', [
      'ÌÑ∞ÎØ∏ÎÑêÏóêÏÑú: python -m http.server 8000',
      'Í∑∏Î¶¨Í≥† http://localhost:8000/ Î°ú Ï†ëÏÜçÌïòÏÑ∏Ïöî.'
    ]);
    dbg('ERROR','file:// ÌôòÍ≤Ω ‚Äî fetch Ï∞®Îã®Îê† Ïàò ÏûàÏùå');
  }
  try{
    const r = await ffetch(DATA_URL,{cache:'no-cache'},'posts.json');
    const j = await r.json();
    ALL = (j.posts||[]).map(p=>({...p,category:p.category||'Í∏∞ÌÉÄ'}));
    if (!Array.isArray(j.posts)) throw new Error('posts.jsonÏóê "posts" Î∞∞Ïó¥Ïù¥ ÏóÜÏäµÎãàÎã§.');
    dbg('INFO',`Î°úÎìúÎêú posts: ${ALL.length}`);
  }catch(e){
    LAST_ERR = (e && e.message) ? e.message : String(e||'');
    ALL = [];
  }
  buildLibraryFromPosts();
  renderCats();
  initLazyCovers();
  attachAnimations();
  route();
  if (DEBUG) runHealthCheck();
})();
</script>
</body>
</html>
