<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ì¼ì • ìº˜ë¦°ë”</title>

<!-- âœ… CSS: jsDelivr â†’ unpkg â†’ (ì„ íƒ)ë¡œì»¬ vendor í´ë°± -->
<link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@toast-ui/calendar@2.1.3/dist/toastui-calendar.min.css"
      onerror="this.onerror=null; this.href='https://unpkg.com/@toast-ui/calendar@2.1.3/dist/toastui-calendar.min.css';">
<link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/tui-date-picker@4.3.3/dist/tui-date-picker.min.css"
      onerror="this.onerror=null; this.href='https://unpkg.com/tui-date-picker@4.3.3/dist/tui-date-picker.min.css';">
<link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/tui-time-picker@2.1.5/dist/tui-time-picker.min.css"
      onerror="this.onerror=null; this.href='https://unpkg.com/tui-time-picker@2.1.5/dist/tui-time-picker.min.css';">

<!-- ë§ˆì§€ë§‰ CSS í´ë°±: ë¡œì»¬ vendor/ (ì„ íƒ) -->
<script>
  addEventListener('error', e => {
    const href = e?.target?.href || '';
    if (!href) return;
    if (href.includes('unpkg.com')) {
      const map = {
        'toastui-calendar.min.css': './vendor/toastui-calendar.min.css',
        'tui-date-picker.min.css':  './vendor/tui-date-picker.min.css',
        'tui-time-picker.min.css':  './vendor/tui-time-picker.min.css',
      };
      const name = href.split('/').pop();
      const l = document.createElement('link');
      l.rel = 'stylesheet'; l.href = map[name] || '';
      if (l.href) document.head.appendChild(l);
    }
  }, true);
</script>

<style>
  /* ===== ë¼ì´íŠ¸/ë‹¤í¬ ë³€ìˆ˜ ===== */
  :root{
    --bg:#0b1217; --panel:#0f161c; --ink:#c7d1d9; --muted:#9fb0bd;
    --line:rgba(255,255,255,.10); --line-strong:rgba(255,255,255,.16);
    --today:#10222e; --select:rgba(89,177,255,.20);
    --header:rgba(13,26,31,.9); --btn:#0e1a1f; --btnh:#0b1628;
  }
  :root[data-theme="light"]{
    --bg:#f6f7f9; --panel:#ffffff; --ink:#27323a; --muted:#51606c;
    --line:rgba(0,0,0,.08); --line-strong:rgba(0,0,0,.14);
    --today:#eef6ff; --select:rgba(42,123,229,.18);
    --header:rgba(255,255,255,.92); --btn:#ffffff; --btnh:#f3f4f6;
  }
  html{color-scheme:dark}
  :root[data-theme="light"] html{color-scheme:light}

  body{margin:0;background:var(--bg);color:var(--ink);
       font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif}

  header{
    position:sticky; top:0; z-index:10;
    display:flex; gap:.5rem; align-items:center; justify-content:space-between; flex-wrap:wrap;
    padding:10px 12px; background:var(--header); border-bottom:1px solid var(--line-strong);
    backdrop-filter:blur(6px) saturate(120%);
  }
  .left,.right{display:flex; gap:.5rem; align-items:center; flex-wrap:wrap}
  button,.btn{
    appearance:none; border:1px solid var(--line-strong); background:var(--btn); color:var(--ink);
    padding:6px 10px; border-radius:10px; cursor:pointer; font-size:14px; text-decoration:none;
  }
  button:hover,.btn:hover{ background:var(--btnh) }
  #range{ color:var(--muted); font-size:.9rem }

  /* ì»¨í…Œì´ë„ˆ ë†’ì´ ë³´ì¥ */
  #calendar{
    height:calc(100vh - 64px); min-height:680px;
    background:var(--panel); border:1px solid var(--line-strong); border-radius:14px; margin:12px; overflow:hidden;
  }

  /* ===== ìº˜ë¦°ë” ë‚´ë¶€ê¹Œì§€ ë¼ì´íŠ¸/ë‹¤í¬ ë°˜ì˜ ===== */
  #calendar [class^="toastui-calendar-"], #calendar [class*=" toastui-calendar-"]{ color:var(--ink) }
  #calendar .toastui-calendar-panel, #calendar .toastui-calendar-layout,
  #calendar .toastui-calendar-month, #calendar .toastui-calendar-week{ background:var(--panel) }
  #calendar [class*="dayname"]{ background:var(--panel); color:var(--muted); border-color:var(--line-strong)!important }
  #calendar [class*="grid-line"], #calendar [class*="grid-cell"]{ border-color:var(--line)!important }
  #calendar .toastui-calendar-week-today, #calendar .toastui-calendar-month-week-item--today{ background:var(--today) }
  #calendar .toastui-calendar-grid-selection{ background:var(--select)!important }
  #calendar .toastui-calendar-event{ border-radius:8px; padding:2px 6px }

  /* ì»´íŒ©íŠ¸ */
  :root[data-compact="1"] #calendar{ font-size:13px }
  :root[data-compact="1"] #calendar .toastui-calendar-allday{ min-height:22px }
  :root[data-compact="1"] #calendar [class*="month"] [class*="grid-cell"]{ height:76px; min-height:76px }
</style>
</head>
<body data-theme="dark" data-compact="1">
  <header>
    <div class="left">
      <button id="btnBack">âŸµ ë’¤ë¡œ</button>
      <a class="btn" id="btnHome" href="../">ğŸ  ë©”ì¸</a>
      <button id="btnPrev">â—€ï¸ ì´ì „</button>
      <button id="btnToday">ì˜¤ëŠ˜</button>
      <button id="btnNext">ë‹¤ìŒ â–¶ï¸</button>
      <button data-view="month">ì›”</button>
      <button data-view="week">ì£¼</button>
      <button data-view="day">ì¼</button>
    </div>
    <div class="right">
      <button id="btnDensity">ì»´íŒ©íŠ¸ ë„ê¸°</button>
      <button id="btnTheme">ë¼ì´íŠ¸ë¡œ</button>
      <span id="range"></span>
    </div>
  </header>

  <div id="calendar"></div>

  <!-- âœ… JS ë™ì  ë¡œë”: jsDelivr â†’ uicdn â†’ unpkg â†’ (ì„ íƒ)ë¡œì»¬ -->
  <script>
    (function loadCalendarLibs(){
      const queues = [
        [
          "https://cdn.jsdelivr.net/npm/tui-date-picker@4.3.3/dist/tui-date-picker.min.js",
          "https://uicdn.toast.com/tui.date-picker/4.3.3/tui-date-picker.min.js",
          "https://unpkg.com/tui-date-picker@4.3.3/dist/tui-date-picker.min.js",
          "./vendor/tui-date-picker.min.js"
        ],
        [
          "https://cdn.jsdelivr.net/npm/tui-time-picker@2.1.5/dist/tui-time-picker.min.js",
          "https://uicdn.toast.com/tui.time-picker/2.1.5/tui-time-picker.min.js",
          "https://unpkg.com/tui-time-picker@2.1.5/dist/tui-time-picker.min.js",
          "./vendor/tui-time-picker.min.js"
        ],
        [
          "https://cdn.jsdelivr.net/npm/@toast-ui/calendar@2.1.3/dist/toastui-calendar.min.js",
          "https://uicdn.toast.com/calendar/2.1.3/toastui-calendar.min.js",
          "https://unpkg.com/@toast-ui/calendar@2.1.3/dist/toastui-calendar.min.js",
          "./vendor/toastui-calendar.min.js"
        ],
      ];

      function loadOne(urls, cb, i=0){
        if(i >= urls.length) return cb(new Error("all urls failed"));
        const s = document.createElement('script');
        s.src = urls[i]; s.defer = true;
        s.onload = () => cb(null);
        s.onerror = () => { s.remove(); loadOne(urls, cb, i+1); };
        document.head.appendChild(s);
      }
      // ìˆœì°¨ ë¡œë“œ
      loadOne(queues[0], () => loadOne(queues[1], () => loadOne(queues[2], (e)=>{
        if (e) showFail('ìº˜ë¦°ë” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (CDN/ë„¤íŠ¸ì›Œí¬/ì°¨ë‹¨ í™•ì¸)');
        else boot();
      })));

      function showFail(msg){
        const box = document.createElement('div');
        box.style.cssText='position:fixed;left:12px;bottom:12px;max-width:560px;background:#111827;color:#fff;padding:12px 14px;border-radius:10px;z-index:99999';
        box.textContent=msg; document.body.appendChild(box);
      }
    })();
  </script>

  <!-- âœ… ìº˜ë¦°ë” ì´ˆê¸°í™” -->
  <script>
    function boot(){
      const Calendar = window.toastui?.Calendar || window.tui?.Calendar;
      if (!Calendar) return;

      const el = document.getElementById('calendar');
      let compact = (document.documentElement.dataset.compact === '1');

      const calendar = new Calendar(el, {
        defaultView: 'month',
        usageStatistics: false,
        useFormPopup: true,
        useDetailPopup: true,
        calendars: [{ id:'default', name:'ë‚´ ì¼ì •' }],
        month: { isAlways6Week:true, startDayOfWeek:1, narrowWeekend:true, visibleEventCount: compact ? 3 : 5 },
        week:  { workweek:true, narrowWeekend:true, showNowIndicator:true, hourStart: compact ? 9 : 8, hourEnd: compact ? 19 : 21 }
      });

      // â”€â”€ ë¡œì»¬ ì €ì¥ â”€â”€
      const KEY='toastui_v2_events';
      let state=[]; try{ state=JSON.parse(localStorage.getItem(KEY)||'[]')||[] }catch(_){}
      if (state.length) calendar.createEvents(state);
      const save=()=>localStorage.setItem(KEY, JSON.stringify(state));
      const upsert=(ev)=>{ const i=state.findIndex(x=>x.id===ev.id&&x.calendarId===ev.calendarId); if(i>=0)state[i]={...state[i],...ev}; else state.push(ev); save(); };
      const remove=(id,calId)=>{ state=state.filter(x=>!(x.id===id&&x.calendarId===calId)); save(); };

      calendar.on('beforeCreateEvent', ev=>{
        const id=String(Date.now())+Math.random().toString(36).slice(2,7);
        const ne={ id, calendarId:ev.calendarId||'default', title:ev.title||'ìƒˆ ì¼ì •', start:ev.start, end:ev.end, isAllday:!!ev.isAllday, category: ev.isAllday?'allday':'time' };
        calendar.createEvents([ne]); upsert(ne);
      });
      calendar.on('beforeUpdateEvent', ({event,changes})=>{ calendar.updateEvent(event.id,event.calendarId,changes); upsert({...event,...changes}); });
      calendar.on('beforeDeleteEvent', ({id,calendarId})=>{ calendar.deleteEvent(id,calendarId); remove(id,calendarId); });

      // â”€â”€ ë²”ìœ„/ë‚´ë¹„ â”€â”€
      const fmt=d=>`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
      const range=()=>{ const s=calendar.getDateRangeStart(),e=calendar.getDateRangeEnd(); document.getElementById('range').textContent=`${fmt(s)} ~ ${fmt(e)}`; };
      range();
      btnPrev.onclick = ()=>{ calendar.prev();  range(); };
      btnToday.onclick= ()=>{ calendar.today(); range(); };
      btnNext.onclick = ()=>{ calendar.next();  range(); };
      document.querySelectorAll('button[data-view]').forEach(b=>b.onclick=()=>{ calendar.changeView(b.dataset.view); range(); });

      // â”€â”€ ë¼ì´íŠ¸/ë‹¤í¬ í† ê¸€ â”€â”€
      btnTheme.onclick=()=>{
        const next=(document.documentElement.dataset.theme==='light')?'dark':'light';
        document.documentElement.dataset.theme=next;
        calendar.render?.();
        btnTheme.textContent = (next==='light') ? 'ë‹¤í¬ë¡œ' : 'ë¼ì´íŠ¸ë¡œ';
      };

      // â”€â”€ ì»´íŒ©íŠ¸ í† ê¸€ â”€â”€
      btnDensity.onclick=()=>{
        const on = document.documentElement.dataset.compact !== '1';
        document.documentElement.dataset.compact = on ? '1' : '0';
        calendar.setOptions?.({
          month:{ visibleEventCount: on ? 3 : 5 },
          week:{ hourStart: on ? 9 : 8, hourEnd: on ? 19 : 21 }
        });
        calendar.render?.();
        btnDensity.textContent = on ? 'ì»´íŒ©íŠ¸ ë„ê¸°' : 'ì»´íŒ©íŠ¸ ì¼œê¸°';
      };

      // â”€â”€ ë’¤ë¡œ/ë©”ì¸ â”€â”€
      btnHome.onclick=(e)=>{ e.preventDefault(); location.href='../'; };
      btnBack.onclick=()=>{ history.length>1 ? history.back() : (location.href='../'); };

      // â”€â”€ ì•ˆì „ ë Œë” â”€â”€
      const safe=()=>{ try{ calendar.render(); }catch(_){} };
      addEventListener('load', safe); new ResizeObserver(safe).observe(el);

      // ë¯¸ë¦¬ë³´ê¸° ì¼ì •(ë³´ì´ëŠ”ì§€ í…ŒìŠ¤íŠ¸ìš©) â€” í•„ìš” ì—†ìœ¼ë©´ ì§€ì›Œë„ ë¨
      const now=new Date();
      calendar.createEvents([{ id:'demo', calendarId:'default', title:'ë¯¸ë¦¬ë³´ê¸°', start:new Date(now.getFullYear(),now.getMonth(),now.getDate(),10), end:new Date(now.getFullYear(),now.getMonth(),now.getDate(),11), category:'time' }]);
    }
  </script>
</body>
</html>
