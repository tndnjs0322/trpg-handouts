<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Schedule</title>

<!-- TUI Calendar v2 CSS (필수) -->
<link rel="stylesheet" href="https://uicdn.toast.com/tui.time-picker/latest/toastui-time-picker.min.css" />
<link rel="stylesheet" href="https://uicdn.toast.com/tui.date-picker/latest/toastui-date-picker.min.css" />
<link rel="stylesheet" href="https://uicdn.toast.com/calendar/latest/toastui-calendar.min.css" />

<style>
  :root {
    --bg: #0b1217;         /* 다크 배경 */
    --panel: #0f161c;
    --ink: #c7d1d9;        /* 기본 글자색 */
    --muted: #9fb0bd;      /* 보조 텍스트 */
    --line: rgba(255,255,255,.10);
    --line-strong: rgba(255,255,255,.16);
    --today-bg: #10222e;
    --accent: #59b1ff;
    --select: rgba(89,177,255,.20);

    /* 컴팩트 */
    --cell-h: 76px;
    --allday-h: 22px;
    --event-pad: 2px 6px;
    --fs: 13px;
  }
  /* 라이트 토글 시 바뀌는 변수 */
  :root[data-theme="light"] {
    --bg: #f6f7f9;
    --panel: #ffffff;
    --ink: #27323a;
    --muted: #51606c;
    --line: rgba(0,0,0,.08);
    --line-strong: rgba(0,0,0,.14);
    --today-bg: #eef6ff;
    --accent: #2a7be5;
    --select: rgba(42,123,229,.18);
  }

  /* 페이지 바탕 및 툴바 */
  html,body {height:100%}
  body {
    margin:0; background:var(--bg); color:var(--ink);
    font-family: Inter, Pretendard, system-ui, -apple-system, "Segoe UI", Roboto, "Malgun Gothic", sans-serif;
  }
  .bar {
    display:flex; align-items:center; gap:.5rem;
    padding:10px 14px; background:var(--panel); border-bottom:1px solid var(--line-strong);
    position:sticky; top:0; z-index:10;
  }
  .bar .spacer {flex:1}
  .bar button, .bar a {
    appearance:none; border:1px solid var(--line-strong); background:transparent; color:var(--ink);
    padding:6px 10px; border-radius:10px; cursor:pointer; font-size:14px; text-decoration:none;
  }
  .bar button:hover, .bar a:hover { background: var(--select); }
  #calendar { height: calc(100dvh - 56px); }

  /* ===== 핵심: 캘린더 내부까지 다크/라이트 강제 오버라이드 ===== */
  /* 캘린더 배경/텍스트 기본값 */
  #calendar [class^="toastui-calendar-"],
  #calendar [class*=" toastui-calendar-"] {
    color: var(--ink);
  }
  /* 월/주/일 공통 패널 배경 */
  #calendar .toastui-calendar-panel,
  #calendar .toastui-calendar-layout,
  #calendar .toastui-calendar-rows,
  #calendar .toastui-calendar-month,
  #calendar .toastui-calendar-week,
  #calendar .toastui-calendar-daygrid,
  #calendar .toastui-calendar-timegrid {
    background: var(--panel);
  }
  /* 요일 헤더 */
  #calendar [class*="dayname"] {
    background: var(--panel);
    color: var(--muted);
    border-color: var(--line-strong) !important;
  }
  /* 그리드 경계선 */
  #calendar [class*="grid-line"],
  #calendar [class*="grid-cell"] {
    border-color: var(--line) !important;
  }
  /* 오늘 배경 강조(월/주/일) */
  #calendar [class*="today"],
  #calendar .toastui-calendar-week-today,
  #calendar .toastui-calendar-month-week-item--today {
    background: var(--today-bg);
  }
  /* 시간축/타임라벨 */
  #calendar [class*="timegrid-time"],
  #calendar .toastui-calendar-timegrid-timezone-label {
    color: var(--muted);
  }
  /* 선택 드래그 영역 */
  #calendar .toastui-calendar-grid-selection {
    background: var(--select) !important;
  }
  /* 이벤트 카드 기본 패딩(컴팩트 대비) */
  #calendar .toastui-calendar-event {
    padding: var(--event-pad);
    border-radius: 6px;
  }

  /* ===== 컴팩트 모드 ===== */
  :root[data-compact="1"] #calendar {
    font-size: var(--fs);
  }
  :root[data-compact="1"] #calendar .toastui-calendar-allday {
    min-height: var(--allday-h);
  }
  :root[data-compact="1"] #calendar [class*="month"] [class*="grid-cell"] {
    height: var(--cell-h); min-height: var(--cell-h);
  }
</style>
</head>
<body data-theme="dark" data-compact="1">
  <div class="bar">
    <a href="../" aria-label="홈으로">홈</a>
    <button id="backBtn" type="button">◀ 뒤로</button>
    <button id="prevBtn" type="button">이전</button>
    <button id="todayBtn" type="button">오늘</button>
    <button id="nextBtn" type="button">다음</button>
    <div class="spacer"></div>
    <button id="viewMonth" type="button">월</button>
    <button id="viewWeek" type="button">주</button>
    <button id="viewDay" type="button">일</button>
    <button id="themeBtn" type="button">라이트</button>
    <button id="compactBtn" type="button">컴팩트 끄기</button>
  </div>

  <div id="calendar"></div>

  <!-- ESM 빌드 (권장) -->
  <script type="module">
    import Calendar from 'https://cdn.jsdelivr.net/npm/@toast-ui/calendar@2.1.3/dist/toastui-calendar.esm.js';

    // 캘린더 생성
    const cal = new Calendar('#calendar', {
      defaultView: 'month',
      usageStatistics: false,
      isReadOnly: false,
      useFormPopup: true,
      useDetailPopup: true,
      week: {
        startDayOfWeek: 0,
        hourStart: 8,
        hourEnd: 22,
        workweek: false,
        showNowIndicator: true,
      },
      month: {
        startDayOfWeek: 0,
        visibleWeeksCount: 0
      },
      template: {} // 필요 시 커스터마이즈
    });

    // 캘린더(카테고리) 별 기본 색상 세트
    cal.setCalendars?.([
      { id: 'default', name: '기본', color: '#e6f2ff', backgroundColor: '#2a7be5', borderColor: '#2a7be5', dragBackgroundColor: '#2a7be5' },
      { id: 'second',  name: '서브', color: '#e9fff5', backgroundColor: '#18a36b', borderColor: '#18a36b', dragBackgroundColor: '#18a36b' }
    ]);

    // 시연용 이벤트 약간
    const now = new Date();
    const pad = n => String(n).padStart(2, '0');
    const ymd = (d) => `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
    cal.createEvents?.([
      { id:'e1', calendarId:'default', title:'회의', start:`${ymd(now)}T10:00:00`, end:`${ymd(now)}T11:00:00`, category:'time' },
      { id:'e2', calendarId:'second',  title:'데모', start:`${ymd(now)}T14:00:00`, end:`${ymd(now)}T15:30:00`, category:'time' },
      { id:'e3', calendarId:'default', title:'종일 일정', start:`${ymd(now)}`, end:`${ymd(now)}`, isAllday:true, category:'allday' }
    ]);

    /* ===== 테마(토큰) + CSS 오버레이 =====
       - setTheme는 선택/지표/요일헤더 등 토큰을 바꾸고,
       - CSS는 그리드 배경/경계선을 확실히 덮어써서 진짜 다크가 되게 합니다.
    */
    const THEMES = {
      dark: {
        common: {
          backgroundColor: getCSS('--panel'),
          gridSelection: { backgroundColor: getCSS('--select') },
          saturday: { color: getCSS('--muted') },
          holiday: { color: getCSS('--muted') },
          dayName: { color: getCSS('--muted') },
          today: { color: getCSS('--accent') }
        },
        week: {
          nowIndicatorLabel: { color: getCSS('--accent') },
        },
        month: {
          dayName: {
            backgroundColor: getCSS('--panel'),
            borderLeft: `1px solid ${getCSS('--line-strong')}`,
            color: getCSS('--muted')
          }
        }
      },
      light: {
        common: {
          backgroundColor: getCSS('--panel'),
          gridSelection: { backgroundColor: getCSS('--select') },
          saturday: { color: getCSS('--muted') },
          holiday: { color: getCSS('--muted') },
          dayName: { color: getCSS('--muted') },
          today: { color: getCSS('--accent') }
        },
        week: {
          nowIndicatorLabel: { color: getCSS('--accent') },
        },
        month: {
          dayName: {
            backgroundColor: getCSS('--panel'),
            borderLeft: `1px solid ${getCSS('--line-strong')}`,
            color: getCSS('--muted')
          }
        }
      }
    };

    function getCSS(name) {
      return getComputedStyle(document.documentElement).getPropertyValue(name).trim();
    }
    function applyTheme(mode = (document.documentElement.dataset.theme || 'dark')) {
      cal.setTheme?.(THEMES[mode]);
      cal.render?.();
    }

    // 초기 다크 적용
    applyTheme('dark');

    /* ===== 툴바 동작 ===== */
    document.getElementById('todayBtn').onclick = () => cal.today();
    document.getElementById('prevBtn').onclick = () => cal.prev();
    document.getElementById('nextBtn').onclick = () => cal.next();
    document.getElementById('viewMonth').onclick = () => cal.changeView('month');
    document.getElementById('viewWeek').onclick = () => cal.changeView('week');
    document.getElementById('viewDay').onclick = () => cal.changeView('day');

    // 뒤로/홈
    document.getElementById('backBtn').onclick = () => history.length > 1 ? history.back() : (location.href = '../');

    // 테마 토글
    const themeBtn = document.getElementById('themeBtn');
    function syncThemeBtn() {
      const mode = document.documentElement.dataset.theme || 'dark';
      themeBtn.textContent = (mode === 'dark') ? '라이트' : '다크';
    }
    themeBtn.onclick = () => {
      const next = (document.documentElement.dataset.theme === 'light') ? 'dark' : 'light';
      document.documentElement.dataset.theme = next;
      applyTheme(next);
      syncThemeBtn();
    };
    syncThemeBtn();

    // 컴팩트 토글
    const compactBtn = document.getElementById('compactBtn');
    function syncCompactBtn(){
      const on = document.documentElement.dataset.compact === '1';
      compactBtn.textContent = on ? '컴팩트 끄기' : '컴팩트 켜기';
    }
    compactBtn.onclick = () => {
      const cur = document.documentElement.dataset.compact;
      document.documentElement.dataset.compact = (cur === '1') ? '0' : '1';
      cal.render?.();
      syncCompactBtn();
    };
    syncCompactBtn();

    // 화면 리사이즈 대응
    addEventListener('resize', () => cal.render?.());
  </script>

  <!-- (UMD 사용이 필요하면 위 <script type="module"> 블록 대신 CDN UMD를 쓰세요)
  <script src="https://uicdn.toast.com/calendar/latest/toastui-calendar.min.js"></script>
  <script> const Calendar = window.tui?.Calendar || window.toastui?.Calendar; /* 동일 로직 */ </script>
  -->
</body>
</html>
