<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>the craft of ui</title>

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />

<style>
@font-face{font-family:'Pretendard';src:url('https://cdn.jsdelivr.net/gh/Project-Noonnu/noonfonts_2107@1.1/Pretendard-Regular.woff') format('woff');font-weight:400;font-style:normal;font-display:swap}
@font-face{font-family:'Pretendard';src:url('https://cdn.jsdelivr.net/gh/Project-Noonnu/noonfonts_2107@1.1/Pretendard-SemiBold.woff') format('woff');font-weight:600;font-style:normal;font-display:swap}
@font-face{font-family:'Pretendard';src:url('https://cdn.jsdelivr.net/gh/Project-Noonnu/noonfonts_2107@1.1/Pretendard-Bold.woff') format('woff');font-weight:700;font-style:normal;font-display:swap}

:root{
  --gap:8px;
  --base:clamp(2rem,8cqi,80px);
  --easing:cubic-bezier(.22,.8,.2,1);
  --speed:.42s;
  --title-dur:.52s;
  --title-delay-in:.06s;

  /* 펼침 폭(중간) */
  --active-fr: 8;
  --inactive-fr: 1;
  --expanded-min: 320px;

  /* 스파인(책등) */
  --spine-w: clamp(28px, calc(var(--base)*0.58), 56px);
  --spine-r: 12px;
  --spine-gloss: linear-gradient(180deg, rgba(255,255,255,.18), rgba(255,255,255,0) 42%);
  --spine-shadow: linear-gradient(90deg, rgba(0,0,0,.26), rgba(0,0,0,0) 50%);

  /* 접힘 때 스파인 아이콘 사이즈/여백 */
  --spine-icon: clamp(14px, calc(var(--spine-w)*0.52), 26px);
  --spine-pad: clamp(8px, calc(var(--spine-w)*0.22), 12px);

  /* 이미지 톤 */
  --tint: hsla(198, 38%, 48%, .10);
}

*{box-sizing:border-box}
html{color-scheme:dark}
body{
  margin:0; min-height:100svh; display:flex; flex-direction:column; align-items:center; justify-content:center;
  gap:1rem; padding-block:2rem; background:#0d1a1f; color:#e6eef2;
  font-family: Inter, Pretendard, system-ui, -apple-system, "Segoe UI", Roboto,
               "Apple SD Gothic Neo","Malgun Gothic","맑은 고딕", Arial, sans-serif;
}
h1,p{margin:0}
h1.fluid{font-size:clamp(28px,6vw,56px); font-weight:700; letter-spacing:.01em; opacity:0; transition:opacity .35s ease}
h1.fluid.show{opacity:1}
body>p{
  width:74ch; max-width:calc(100% - 4rem); text-wrap:balance; margin-bottom:4rem;
  line-height:1.55; opacity:.9; font-weight:400;
}
@media (max-width:768px){ body>p{ text-align:center } }

/* 리스트 */
ul{
  display:grid; 
  grid-template-columns:repeat(7,1fr);
  gap:var(--gap); list-style:none; justify-content:center; padding:0; margin:0;
  height:clamp(300px,40dvh,474px);
  width: clamp(820px, 86vw, 1040px);
  max-width: 100%;
  transition:grid-template-columns var(--speed) var(--easing);
}
li{
  position:relative; overflow:hidden; min-width:var(--base);
  border-radius:12px; background:#0f1b20; border:1px solid rgba(255,255,255,.12);
  contain:layout paint;
  z-index:0;
}
li[data-active="true"]{ z-index:1; }
article{
  position:absolute; inset:0; width:100%; height:100%;
  display:flex; flex-direction:column; justify-content:flex-end; gap:.8rem;
  padding-inline: clamp(10px, calc(var(--base)*.42), 22px);
  padding-bottom: clamp(10px, calc(var(--base)*.42), 18px);
  overflow:hidden;
}

/* 뒤 블러 배경 + 틴트 */
article::before{
  content:""; position:absolute; inset:0; z-index:0;
  background:
    linear-gradient(0deg, var(--tint), var(--tint)),
    center/cover no-repeat var(--img, none);
  filter: blur(16px) brightness(.86) saturate(.95);
  transform: scale(1.06);
  transition: filter var(--speed) var(--easing), opacity var(--speed) var(--easing);
  opacity:.9;
}

/* 스크림(펼침때 가독성) */
.scrim{
  position:absolute; inset:0; z-index:1;
  background: linear-gradient(to top, rgba(0,0,0,.40), rgba(0,0,0,0) 55%);
  opacity:0; transition: opacity var(--speed) var(--easing);
}

/* 스파인(접힘때 표시) */
article::after{
  content:""; position:absolute; top:0; left:0; height:100%; width:var(--spine-w);
  border-top-left-radius: var(--spine-r); border-bottom-left-radius: var(--spine-r);
  background:
    var(--spine-gloss),
    var(--spine-shadow),
    linear-gradient(0deg, var(--tint), var(--tint)),
    center/cover no-repeat var(--img, none);
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,.06),
    0 0 0 1px rgba(255,255,255,.08);
  filter: saturate(1.02) contrast(1.02) brightness(.98) grayscale(.04);
  opacity:0;
  transition: opacity var(--speed) var(--easing), filter var(--speed) var(--easing);
  z-index:3; pointer-events:none;
}

/* 본 이미지 */
article img{
  position:absolute; inset:0; width:100%; height:100%;
  object-fit: cover;
  z-index:0; pointer-events:none; opacity:1; transition:opacity var(--speed) var(--easing);
}

/* 텍스트 */
article p{ margin:0; font-size:13px; line-height:1.28; text-wrap:balance; position:relative; z-index:2; opacity:0; transition:opacity calc(var(--speed)*1.05) var(--easing) }

/* 아이콘: 기본(펼침 시) = 카드 안쪽 좌하단 */
article svg{
  position:absolute;
  left: clamp(12px, calc(var(--base)*.5), 28px);
  bottom: 12px;
  width: 18px;
  height: 18px;
  fill:none;
  z-index: 2;
  opacity: .85;
  pointer-events: none; /* 호버/클릭 방해 금지 */
  transition:
    transform var(--speed) var(--easing),
    opacity var(--speed) var(--easing),
    left var(--speed) var(--easing),
    bottom var(--speed) var(--easing),
    width var(--speed) var(--easing),
    height var(--speed) var(--easing),
    z-index var(--speed) var(--easing),
    filter var(--speed) var(--easing);
}

/* 접힘 상태: 스파인 아래쪽에 아이콘 보이기(가로는 스파인 중앙) */
li:not([data-active="true"]) article svg{
  left: 0;
  bottom: var(--spine-pad);
  transform: none;
  width: var(--spine-icon);
  height: var(--spine-icon);
  opacity: 1;
  z-index: 4; /* 스파인(::after, z=3) 위로 */
  margin-left: calc((var(--spine-w) - var(--spine-icon)) / 2); /* 가로 중앙 정렬 */
  filter: drop-shadow(0 1px 2px rgba(0,0,0,.45));
}

/* 펼치면 카드 안쪽으로 복귀 */
li[data-active="true"] article svg{
  left: clamp(12px, calc(var(--base)*.5), 28px);
  bottom: 12px;
  transform: none;
  width: 18px;
  height: 18px;
  opacity: .85;
  z-index: 2;
  filter: none;
}

/* 접힘/펼침 상태에 따른 이미지/텍스트/스크림 */
li:not([data-active="true"]) article img{ opacity:0 }
li:not([data-active="true"]) .scrim{ opacity:0 }
li:not([data-active="true"]) article::after{ opacity:1 }
li[data-active="true"] .scrim{ opacity:1 }
li[data-active="true"] p{ opacity:1; transition-delay:calc(var(--speed)*.12) }

/* 제목 세로↔가로 전환 */
.title{
  position:absolute; inset:0; display:grid; place-items:center; pointer-events:none;
  font-weight:700; letter-spacing:.02em; z-index:2;
}
.title .t{
  position:absolute; will-change: transform, opacity, letter-spacing, clip-path, filter;
  transition:
    opacity        var(--title-dur) var(--easing),
    transform      var(--title-dur) var(--easing),
    filter         var(--title-dur) var(--easing),
    letter-spacing var(--title-dur) var(--easing),
    clip-path      var(--title-dur) var(--easing);
}
li:not([data-active="true"]) .title .t-v{ opacity:1; transform:translateY(0) scale(1) }
li:not([data-active="true"]) .title .t-h{
  opacity:0; transform: translateX(-12px) skewX(-2deg);
  letter-spacing:.05em; clip-path: inset(0 35% 0 0 round 2px); filter: blur(.2px);
}
li[data-active="true"] .title .t-v{
  opacity:0; transform:translateY(-6px) scale(.985); filter: blur(.18px);
}
li[data-active="true"] .title .t-h{
  opacity:1; transform: translateX(0) skewX(0deg);
  letter-spacing:.01em; clip-path: inset(0 0 0 0 round 2px); filter:none;
  transition-delay: var(--title-delay-in);
}
.title .t-v{
  writing-mode:vertical-rl; text-orientation:mixed;
  left:calc(var(--spine-w) + 8px); top:12px;
  transform-origin:top left; font-weight:700; letter-spacing:.08em; font-size:.98rem;
  align-self:start; justify-self:start;
}
.title .t-h{
  writing-mode:initial; white-space:nowrap; text-overflow:ellipsis; overflow:hidden;
  top:12px; left: clamp(12px, calc(var(--base)*.5), 28px);
  font-size:1rem; font-weight:700; text-transform:uppercase; transform-origin:left center;
}

/* H1: 쉬ーン(무지갯빛) 1회 */
h1.fluid.sheen {
  background-image: linear-gradient(90deg,#7ee8fa,#6aa4ff,#b08ad6,#8cb9ff);
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  background-size: 200% 100%;
  animation: h1-sheen 1300ms cubic-bezier(.22,.8,.2,1) 120ms both;
}
@keyframes h1-sheen {
  0% { background-position: 0% 50% }
  100% { background-position: 100% 50% }
}

/* H1: 미세 글리치(아주 가끔) */
h1.fluid { position: relative; }
h1.fluid.glitch { animation: h1-jitter 120ms steps(2,end) 1; }
@keyframes h1-jitter {
  0%   { transform: translate3d(0,0,0) }
  50%  { transform: translate3d(1px,-1px,0) skewX(.6deg) }
  100% { transform: translate3d(0,0,0) }
}
h1.fluid.glitch::before,
h1.fluid.glitch::after{
  content: attr(data-text);
  position:absolute; inset:0; pointer-events:none; opacity:.35;
  mix-blend-mode: screen;
}
h1.fluid.glitch::before{
  clip-path: inset(60% 0 25% 0);
  transform: translateX(-1px);
  text-shadow: 1px 0 #f0f;
}
h1.fluid.glitch::after{
  clip-path: inset(30% 0 55% 0);
  transform: translateX(1px);
  text-shadow: -1px 0 #0ff;
}

/* 배경 캔버스 */
#bg-dots{position:fixed; inset:0; z-index:-1; pointer-events:none}

/* ===== Glitch Language (0.1%) 보조 시각효과(전체) ===== */
body.glitch-lang {
  --glitch-shadow: 1px;
}
body.glitch-lang :where(h1,h2,h3,h4,h5,h6,p,li,span,a,strong,em,small){
  position: relative;
  text-shadow:
    var(--glitch-shadow) 0 #f0f,
    calc(var(--glitch-shadow) * -1) 0 #0ff;
}
@media (prefers-reduced-motion: reduce) {
  body.glitch-lang :where(h1,h2,h3,h4,h5,h6,p,li,span,a,strong,em,small){
    text-shadow: .5px 0 #f0f, -.5px 0 #0ff;
  }
}

/* ===== 카드 로컬 글리치(제목/내용 전용) ===== */
article.glitch-lang :where(h3, p, .title .t-h, .title .t-v, span){
  position: relative;
  text-shadow:
    var(--glitch-shadow, 1px) 0 #f0f,
    calc(var(--glitch-shadow, 1px) * -1) 0 #0ff;
}
@media (prefers-reduced-motion: reduce) {
  article.glitch-lang :where(h3, p, .title .t-h, .title .t-v, span){
    text-shadow: .5px 0 #f0f, -.5px 0 #0ff;
  }
}
/* 아이콘/여백 변수 (원하는 크기로 조절 가능) */
:root{
  --icon-size: 20px;   /* 펼친 상태 아이콘 크기 */
  --icon-gap: 8px;     /* 아이콘과 텍스트 사이 간격 */
}

/* 기존 article 패딩을 변수화 (아래 규칙이 같은 선택자라 자연스럽게 덮어씀) */
article{
  --pad-x-base: clamp(10px, calc(var(--base)*.42), 22px);
  --pad-b-base: clamp(10px, calc(var(--base)*.42), 18px);
  padding-inline: var(--pad-x-base);
  padding-bottom: var(--pad-b-base);
}

/* 펼친 상태일 때: 아이콘만큼 자동으로 안전 여백 확보 */
li[data-active="true"] article{
  --pad-left-safe: calc(var(--pad-x-base) + var(--icon-size) + var(--icon-gap));
  --pad-bottom-safe: calc(var(--pad-b-base) + var(--icon-size) + var(--icon-gap));
  padding-left: max(var(--pad-x-base), var(--pad-left-safe));
  padding-bottom: max(var(--pad-b-base), var(--pad-bottom-safe));
}

/* 펼친 상태 아이콘을 좌측하단으로 고정 (텍스트는 위 패딩 덕에 안 겹침) */
li[data-active="true"] article svg{
  left: var(--pad-x-base);
  bottom: var(--pad-b-base);
  right: auto; top: auto;
  width: var(--icon-size);
  height: var(--icon-size);
}  
</style>
</head>
<body>
<canvas id="bg-dots" aria-hidden="true"></canvas>

<h1 class="fluid">네버엔딩 크툴루 1호점</h1>
<p>
  Trembling, they moved Lovecraft to nonfiction
</p>

<ul>
  <li>
    <article>
      <div class="scrim" aria-hidden="true"></div>
      <h3 class="title" aria-label="The Craft">
        <span class="t t-h">The Craft</span>
        <span class="t t-v" aria-hidden="true">The Craft</span>
      </h3>
      <p>Gain the confidence to build anything you envision, transforming motion, interaction, and design principles into second nature.</p>
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 3h12l4 6-10 13L2 9Z"/><path d="M11 3 8 9l4 13 4-13-3-6"/><path d="M2 9h20"/></svg>
      <img src="https://picsum.photos/1200/800?random=12" alt="" />
    </article>
  </li>
  <li>
    <article>
      <div class="scrim" aria-hidden="true"></div>
      <h3 class="title" aria-label="CSS Animation">
        <span class="t t-h">CSS Animation</span>
        <span class="t t-v" aria-hidden="true">CSS Animation</span>
      </h3>
      <p>Master CSS animations from your first @keyframes to the tricks nobody teaches.</p>
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M7 3v18"/><path d="M3 7.5h4"/><path d="M3 12h18"/><path d="M3 16.5h4"/><path d="M17 3v18"/><path d="M17 7.5h4"/><path d="M17 16.5h4"/></svg>
      <img src="https://picsum.photos/1200/800?random=17" alt="" />
    </article>
  </li>
  <li>
    <article>
      <div class="scrim" aria-hidden="true"></div>
      <h3 class="title" aria-label="SVG Filters">
        <span class="t t-h">SVG Filters</span>
        <span class="t t-v" aria-hidden="true">SVG Filters</span>
      </h3>
      <p>Use noise and filters to craft flames, stickers, and more — shaders on a budget.</p>
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg>
      <img src="https://picsum.photos/1200/800?random=19" alt="" />
    </article>
  </li>
  <li>
    <article>
      <div class="scrim" aria-hidden="true"></div>
      <h3 class="title" aria-label="Scroll Animation">
        <span class="t t-h">Scroll Animation</span>
        <span class="t t-v" aria-hidden="true">Scroll Animation</span>
      </h3>
      <p>Guide users with tasteful, performance-first scroll effects.</p>
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 17V5a2 2 0 0 0-2-2H4"/><path d="M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3"/></svg>
      <img src="https://picsum.photos/1200/800?random=42" alt="" />
    </article>
  </li>
  <li>
    <article>
      <div class="scrim" aria-hidden="true"></div>
      <h3 class="title" aria-label="Taming Canvas">
        <span class="t t-h">Taming Canvas</span>
        <span class="t t-v" aria-hidden="true">Taming Canvas</span>
      </h3>
      <p>Tame the pixel playground with performance-driven patterns.</p>
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="13.5" cy="6.5" r=".5" fill="currentColor"/><circle cx="17.5" cy="10.5" r=".5" fill="currentColor"/><circle cx="8.5" cy="7.5" r=".5" fill="currentColor"/><circle cx="6.5" cy="12.5" r=".5" fill="currentColor"/><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z"/></svg>
      <img src="https://picsum.photos/1200/800?random=128" alt="" />
    </article>
  </li>
  <li>
    <article>
      <div class="scrim" aria-hidden="true"></div>
      <h3 class="title" aria-label="Layout Tricks">
        <span class="t t-h">Layout Tricks</span>
        <span class="t t-v" aria-hidden="true">Layout Tricks</span>
      </h3>
      <p>Sometimes a rethink beats adding another library.</p>
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72"/><path d="m14 7 3 3"/><path d="M5 6v4"/><path d="M19 14v4"/><path d="M10 2v2"/><path d="M7 8H3"/><path d="M21 16h-4"/><path d="M11 3H9"/></svg>
      <img src="https://picsum.photos/1200/800?random=56" alt="" />
    </article>
  </li>
  <li data-link="roll20/" role="link" tabindex="0">
    <article>
      <div class="scrim" aria-hidden="true"></div>
      <h3 class="title" aria-label="Mastering Time">
        <span class="t t-h">Mastering Time</span>
        <span class="t t-v" aria-hidden="true">Mastering Time</span>
      </h3>
      <p>시간은 지나가지만 그 흔적은 남는다 그것을 누가 막겠는가?.</p>
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 22h14"/><path d="M5 2h14"/><path d="M17 22v-4.172a2 2 0 0 0-.586-1.414L12 12l-4.414 4.414A2 2 0 0 0 7 17.828V22"/><path d="M7 2v4.172a2 2 0 0 0 .586 1.414L12 12l-4.414-4.414A2 2 0 0 0 17 6.172V2"/></svg>
      <img src="https://picsum.photos/1200/800?random=39" alt="" />
    </article>
  </li>
</ul>

<script>
/* 펼침 비율 & 상태 관리 */
(() => {
  const list = document.querySelector('ul');
  if (!list) return;
  const items = Array.from(list.querySelectorAll('li'));
  let active = -1, raf = 0;

  const css = getComputedStyle(document.documentElement);
  const ACTIVE_FR = parseFloat(css.getPropertyValue('--active-fr')) || 8;
  const INACTIVE_FR = parseFloat(css.getPropertyValue('--inactive-fr')) || 1;
  const EXPANDED_MIN = (css.getPropertyValue('--expanded-min') || '320px').trim();

  const setCols = (idx) => {
    list.style.gridTemplateColumns = items.map((_, i) =>
      i === idx
        ? `minmax(${EXPANDED_MIN}, ${ACTIVE_FR}fr)`
        : `minmax(var(--spine-w), ${INACTIVE_FR}fr)`
    ).join(' ');
  };

  const applyActive = (idx) => {
    if (idx === active) return;
    active = idx;
    items.forEach((li, i) => li.dataset.active = (i === active).toString());
    setCols(active);
  };

  const collapse = () => {
    if (active === -1) return;
    active = -1;
    items.forEach((li) => li.dataset.active = 'false');
    list.style.gridTemplateColumns = `repeat(${items.length}, 1fr)`;
  };

  const schedule = (idx) => {
    if (idx === active) return;
    cancelAnimationFrame(raf);
    raf = requestAnimationFrame(() => applyActive(idx));
  };

items.forEach((li, i) => {
  li.addEventListener('pointerenter', () => schedule(i), { passive: true });
  li.addEventListener('click', () => {
  const url = li.dataset.link;
  if (url) {
    window.open(url, '_blank', 'noopener,noreferrer'); // 새 탭으로 열기
  } else {
    applyActive(i);
  }
});
  li.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
      const url = li.dataset.link;
      if (url) {window.open(url, '_blank', 'noopener');} else { applyActive(i); }
    }
  });
  li.addEventListener('focusin', () => applyActive(i));
});
  list.addEventListener('pointerleave', collapse);
  list.addEventListener('focusout', (e) => { if (!list.contains(e.relatedTarget)) collapse(); });

  collapse();
})();

/* 이미지 URL을 CSS 변수(--img)로 투입 */
(() => {
  const arts = document.querySelectorAll('article');
  arts.forEach((a) => {
    const img = a.querySelector('img');
    if (!img) return;
    const apply = () => a.style.setProperty('--img', `url("${img.currentSrc || img.src}")`);
    if (img.complete) apply(); else img.addEventListener('load', apply, { once: true });
  });
})();

/* 상단 H1: 첫 방문 1회 타이핑 + 쉬ーン + 가끔 글리치 */
(() => {
  const h1 = document.querySelector('h1.fluid');
  if (!h1) return;
  const text = h1.textContent.trim();
  const seen = sessionStorage.getItem('__title_typed__') === '1';
  const reduce = matchMedia?.('(prefers-reduced-motion: reduce)').matches ?? false;

  function show(){ h1.classList.add('show'); }
  function typeOnce(speed = 34){
    h1.textContent = ''; show();
    let i = 0;
    const id = setInterval(() => {
      if (i >= text.length){
        clearInterval(id);
        sessionStorage.setItem('__title_typed__','1');
        h1.classList.add('sheen');
        setTimeout(()=>h1.classList.remove('sheen'), 1600);
        return;
      }
      h1.append(text[i++]);
    }, speed);
  }
  if (reduce || seen){ h1.textContent = text; show(); } else { typeOnce(); }

  // H1 가끔 글리치(1%)
  h1.setAttribute('data-text', text);
  const maybeGlitch = () => {
    if (Math.random() < 0.01) {
      h1.classList.add('glitch');
      setTimeout(() => h1.classList.remove('glitch'), 140);
    }
  };
  h1.addEventListener('pointerenter', maybeGlitch);
  h1.addEventListener('pointermove', () => { if (Math.random() < 0.003) maybeGlitch(); });
})();

/* 배경: 은은하게 움직이는 점 */
(() => {
  const cvs = document.getElementById('bg-dots'); if (!cvs) return;
  const ctx = cvs.getContext('2d', { alpha: true });

  let W=0, H=0, DPR=1, pts=[], last=0, raf=0;
  const OPT = { density: 0.00006, min: 60, max: 140, r: [0.7, 2.2], v: [3, 11], a: [0.05, 0.16], hz: [.10, .24], blur: 6 };
  const reduce = matchMedia?.('(prefers-reduced-motion: reduce)').matches ?? false;
  const rnd = (a,b)=> a + Math.random()*(b-a);

  function resize(){
    DPR = Math.min(2, devicePixelRatio || 1);
    W = cvs.width  = Math.floor(innerWidth  * DPR);
    H = cvs.height = Math.floor(innerHeight * DPR);
    cvs.style.width  = innerWidth + 'px';
    cvs.style.height = innerHeight + 'px';
    spawn();
  }
  function spawn(){
    const area = innerWidth * innerHeight;
    const n = Math.max(OPT.min, Math.min(OPT.max, Math.round(area * OPT.density)));
    pts = Array.from({length:n}, () => {
      const r  = rnd(...OPT.r) * DPR;
      const sp = rnd(...OPT.v) * DPR;
      const a  = Math.random() * Math.PI * 2;
      return {
        x: Math.random()*W, y: Math.random()*H, r,
        vx: Math.cos(a)*sp, vy: Math.sin(a)*sp,
        h: 200 + Math.random()*20, s: 28 + Math.random()*18, l: 76 + Math.random()*8,
        alpha: rnd(...OPT.a), ph: Math.random()*Math.PI*2, f: rnd(...OPT.hz)*2*Math.PI
      };
    });
  }
  function frame(t){
    const dt = Math.min(.05, (t-(last||t))/1000); last = t;
    ctx.clearRect(0,0,W,H);
    ctx.globalCompositeOperation = 'lighter';
    for (const p of pts){
      p.ph += p.f * dt;
      const tw = .5 + .5*Math.sin(p.ph);
      const al = p.alpha * (.7 + .3*tw);
      ctx.shadowColor = `hsla(${p.h} ${p.s}% ${p.l}% / ${al*1.2})`;
      ctx.shadowBlur  = OPT.blur * DPR;
      ctx.fillStyle   = `hsla(${p.h} ${p.s}% ${p.l}% / ${al})`;
      ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI*2); ctx.fill();

      p.x += p.vx*dt; p.y += p.vy*dt;
      if (p.x < -5) p.x = W+5; else if (p.x > W+5) p.x = -5;
      if (p.y < -5) p.y = H+5; else if (p.y > H+5) p.y = -5;
    }
    raf = requestAnimationFrame(frame);
  }
  function start(){
    cancelAnimationFrame(raf); resize();
    if (reduce){ ctx.clearRect(0,0,W,H); return; }
    raf = requestAnimationFrame(frame);
  }
  addEventListener('resize', resize);
  start();
})();

/* ===== 0.1% 확률 “글리치 언어” 이스터에그(전체 본문) =====
   - 페이지 로드 시 0.001 (=0.1%) 확률로 발동
   - 텍스트 일부를 글리치풍 유니코드로 치환
   - 6초 뒤 자동 복구, 세션당 1회
   - 테스트: URL에 ?glang=1
*/
(() => {
  const force = /(?:\?|&)glang=1\b/.test(location.search);
  const seen = sessionStorage.getItem('__glang_done__') === '1';
  const reduce = matchMedia?.('(prefers-reduced-motion: reduce)').matches ?? false;

  if (reduce) return;
  if (!force && (seen || Math.random() >= 0.001)) return;
  sessionStorage.setItem('__glang_done__', '1');

  const DURATION = 6000;
  const IGNORE_TAGS = new Set(['SCRIPT','STYLE','NOSCRIPT','IFRAME','SVG','CANVAS']);
  const replaced = [];

  const ALT = {
    A:'Λ',B:'ß',C:'ᄃ',D:'Ɗ',E:'Ξ',F:'Ғ',G:'Ǥ',H:'Ħ',I:'ɪ',J:'ʆ',
    K:'Ҝ',L:'Ꮮ',M:'ᴍ',N:'И',O:'Ø',P:'Ƥ',Q:'Ǫ',R:'Я',S:'Ƨ',T:'Ŧ',
    U:'Џ',V:'Ṽ',W:'Ш',X:'Ӿ',Y:'¥',Z:'Ẕ',
    a:'ʌ',b:'ь',c:'ς',d:'ɖ',e:'ɛ',f:'ғ',g:'ɠ',h:'ђ',i:'ɨ',j:'ʝ',
    k:'ҡ',l:'l',m:'ɯ',n:'п',o:'ø',p:'ρ',q:'φ',r:'я',s:'ᔓ',t:'ŧ',
    u:'ս',v:'√',w:'ω',x:'ж',y:'у',z:'ž',
    '0':'𝟘','1':'𝟙','2':'𝟚','3':'𝟛','4':'𝟜','5':'𝟝','6':'𝟞','7':'𝟟','8':'𝟠','9':'𝟡'
  };
  const COMB = ['\u0336','\u033f','\u0348'];
  const maybeComb = (ch) => (Math.random() < 0.06 ? ch + COMB[(Math.random()*COMB.length)|0] : ch);
  const glitchify = (str) => str.replace(/./g, ch => ALT[ch] ? maybeComb(ALT[ch]) : ch);

  const walker = document.createTreeWalker(
    document.body,
    NodeFilter.SHOW_TEXT,
    {
      acceptNode(node) {
        const p = node.parentElement;
        if (!p) return NodeFilter.FILTER_REJECT;
        if (IGNORE_TAGS.has(p.tagName)) return NodeFilter.FILTER_REJECT;
        if (p.closest('svg,[aria-hidden="true"],[hidden]')) return NodeFilter.FILTER_REJECT;
        const v = node.nodeValue;
        if (!v || !v.trim()) return NodeFilter.FILTER_REJECT;
        return NodeFilter.FILTER_ACCEPT;
      }
    }
  );
  let n;
  while ((n = walker.nextNode())) {
    const txt = n.nodeValue;
    replaced.push({ node: n, text: txt });
    n.nodeValue = glitchify(txt);
  }
  document.body.classList.add('glitch-lang');

  setTimeout(() => {
    for (const rec of replaced) if (rec.node.parentNode) rec.node.nodeValue = rec.text;
    document.body.classList.remove('glitch-lang');
  }, DURATION);
})();

/* ===== 카드 개별 글리치 언어 (1%) =====
   - 각 카드(article)에서 pointerenter/click 시 1% 확률 발동
   - 라틴/숫자는 대체 유니코드로 치환, 한글은 가독성 위해 글자 유지(채널 분리 효과만)
   - 1.8초 뒤 자동 복구
   - 카드당 쿨다운(3.5초) 적용
*/
(() => {
  const reduce = matchMedia?.('(prefers-reduced-motion: reduce)').matches ?? false;
  if (reduce) return;

  const ALT = {
    A:'Λ',B:'ß',C:'ᄃ',D:'Ɗ',E:'Ξ',F:'Ғ',G:'Ǥ',H:'Ħ',I:'ɪ',J:'ʆ',
    K:'Ҝ',L:'Ꮮ',M:'ᴍ',N:'И',O:'Ø',P:'Ƥ',Q:'Ǫ',R:'Я',S:'Ƨ',T:'Ŧ',
    U:'Џ',V:'Ṽ',W:'Ш',X:'Ӿ',Y:'¥',Z:'Ẕ',
    a:'ʌ',b:'ь',c:'ς',d:'ɖ',e:'ɛ',f:'ғ',g:'ɠ',h:'ђ',i:'ɨ',j:'ʝ',
    k:'ҡ',l:'l',m:'ɯ',n:'п',o:'ø',p:'ρ',q:'φ',r:'я',s:'ᔓ',t:'ŧ',
    u:'ս',v:'√',w:'ω',x:'ж',y:'у',z:'ž',
    '0':'𝟘','1':'𝟙','2':'𝟚','3':'𝟛','4':'𝟜','5':'𝟝','6':'𝟞','7':'𝟟','8':'𝟠','9':'𝟡'
  };
  const COMB = ['\u0336','\u033f','\u0348']; // 얇은 취소선/위첨 등
  const maybeComb = (ch) => (Math.random() < 0.06 ? ch + COMB[(Math.random()*COMB.length)|0] : ch);
  const glitchify = (str) => str.replace(/./g, ch => ALT[ch] ? maybeComb(ALT[ch]) : ch);

  const IGNORE_TAGS = new Set(['SCRIPT','STYLE','NOSCRIPT','IFRAME','SVG','CANVAS']);

  const glitchArticle = (article, DUR=1800) => {
    const replaced = [];
    const walker = document.createTreeWalker(
      article,
      NodeFilter.SHOW_TEXT,
      {
        acceptNode(node){
          const el = node.parentElement;
          if (!el) return NodeFilter.FILTER_REJECT;
          if (IGNORE_TAGS.has(el.tagName)) return NodeFilter.FILTER_REJECT;
          if (el.closest('svg,[aria-hidden="true"],[hidden]')) return NodeFilter.FILTER_REJECT;
          // 제목(.title 내부) 또는 본문 <p>만
          if (!el.closest('.title, p')) return NodeFilter.FILTER_REJECT;
          const v = node.nodeValue;
          if (!v || !v.trim()) return NodeFilter.FILTER_REJECT;
          return NodeFilter.FILTER_ACCEPT;
        }
      }
    );
    let n;
    while ((n = walker.nextNode())) {
      const txt = n.nodeValue;
      replaced.push({ node:n, text:txt });
      n.nodeValue = glitchify(txt); // 라틴/숫자 치환
    }
    article.classList.add('glitch-lang'); // 채널 분리 비주얼
    setTimeout(() => {
      for (const rec of replaced) if (rec.node.parentNode) rec.node.nodeValue = rec.text;
      article.classList.remove('glitch-lang');
    }, DUR);
  };

  const PROB = 0.01;       // 1%
  const COOLDOWN = 3500;   // ms
  const arts = document.querySelectorAll('ul li article');
  arts.forEach((art) => {
    let cooling = false;
    const tryGlitch = () => {
      if (cooling) return;
      if (Math.random() < PROB) {
        cooling = true;
        glitchArticle(art);
        setTimeout(() => (cooling = false), COOLDOWN);
      }
    };
    art.addEventListener('pointerenter', tryGlitch, { passive: true });
    art.addEventListener('click', tryGlitch);
  });
})();
</script>
</body>
</html>
